/* js/dist/captchaV2TemplatesBundle.js */
angular.module("captchaV2Templates", []).run(["$templateCache", function($templateCache) {
$templateCache.put("captcha", "<div class=modal ng-class=$ctrl.getCaptchaClasses() ng-click=$ctrl.hideCaptcha()><div class=modal-dialog><div class=modal-content><div class=modal-body><div id=\"{{ $ctrl.id }}\" class=captchav2-funcaptcha-modal-body></div></div></div></div></div>");
}]);

/* js/dist/captchaV2Bundle.js */
"use strict";(Roblox=Roblox||{}).CaptchaConstants=Roblox.CaptchaConstants||{endpoints:{sendMessage:"",addFriend:"",follow:"",signup:"",joinGroup:"",login:"",postComment:"",clothingUpload:"",favorite:"",appSignup:"",appLogin:""},serviceData:{sitekey:"",trulyInvisibleSitekey:"",successSuffix:"Captcha_Success",failSuffix:"Captcha_Failed",displayedSuffix:"Captcha_Displayed",captchaSolvedPrefix:"Captcha_User_Solved_InSeconds_",captchaSolveTimeIntervals:[{seconds:1,suffix:"Less_Than_1"},{seconds:3,suffix:"1_To_3"},{seconds:10,suffix:"4_To_10"},{seconds:20,suffix:"11_To_20"},{seconds:30,suffix:"21_To_30"},{seconds:40,suffix:"31_To_40"},{seconds:50,suffix:"41_To_50"}],captchaSolveTimeLarge:"Greater_Than_50",badgePosition:"bottomright",logConstants:{successSuffix:"_Success",failSuffix:"_Failed",maxFailSuffix:"_MaxFailed",retrySuffix:"_Retried",displayedSuffix:"_Displayed",triggeredSuffix:"_Triggered",initializedSuffix:"_Initialized",suppressedSuffix:"_Suppressed",providerErrorSuffix:"_FailedToLoad",completedTimeSequenceSuffix:"_SolveTime",solvedPrefix:"_User_Solved_InSeconds_",solveTimeIntervals:[{seconds:1,suffix:"Less_Than_1"},{seconds:3,suffix:"1_To_3"},{seconds:10,suffix:"4_To_10"},{seconds:20,suffix:"11_To_20"},{seconds:30,suffix:"21_To_30"},{seconds:40,suffix:"31_To_40"},{seconds:50,suffix:"41_To_50"}],solveTimeLarge:"Greater_Than_50",eventStreamCaptchaEventName:"captcha",eventStreamCaptchaInitiatedEventName:"captchaInitiated",eventStreamCaptchaTokenReceivedEventName:"captchaTokenReceived",captchaInitiatedChallengeTypes:{visible:"visible",hidden:"hidden",error:"error"}}},types:{signup:"signup",sendMessage:"sendMessage",addFriend:"addFriend",follow:"follow",joinGroup:"joinGroup",login:"login",postComment:"postComment",clothingUpload:"clothingUpload",favorite:"favorite",appSignup:"appSignup",appLogin:"appLogin",gameCardRedeem:"gameCardRedeem"},ids:{defaultCaptcha:"captcha-container",signup:"signup-captcha",login:"login-captcha",friends:"friends-captcha",groups:"groups-captcha",profile:"profile-captcha",playerSearch:"player-search-captcha",appCaptcha:"app-captcha",gameCardRedeem:"game-card-redeem-captcha"},messageElementIds:{defaultError:"captcha-error"},hybridEvents:{shown:"CaptchaShown",success:"CaptchaSuccess"},messages:{error:"We currently cannot verify CAPTCHA, please try again later.",funCaptchaError:"We currently cannot verify FunCaptcha, please try again later."}};var Roblox=Roblox||{},EventTracker=window.EventTracker||null;Roblox.CaptchaLogger=function(e){var t,a=Roblox.CaptchaConstants,n=$.extend({},a.serviceData).logConstants,i=!1;function o(e){return i&&void 0!==t?e+"_"+t:e}function c(e){return e.charAt(0).toUpperCase()+e.slice(1)}this.provider=e,this.setPerAppTypeLoggingEnabled=function(e){Roblox.DeviceMeta&&Roblox.DeviceMeta().isInApp&&(i=e,t=Roblox.DeviceMeta().appType)},this.fireEvent=function(e,t){t=c(e+this.provider+t),EventTracker&&EventTracker.fireEvent(o(t))},this.startStatisticsSequence=function(e){EventTracker&&EventTracker.start(o(e))},this.endStatisticsSequenceWithSuccess=function(e){EventTracker&&EventTracker.endSuccess(o(e))},this.endStatisticsSequenceWithFailure=function(e){EventTracker&&EventTracker.endFailure(o(e))},this.logSolveTime=function(e,t){var a=function(e){for(var t=n.solvedPrefix,a=n.solveTimeIntervals,i=0;i<a.length;i++){var o=a[i];if(e<=1e3*o.seconds)return t+o.suffix}return t+n.solveTimeLarge}(t);this.fireEvent(e,a)},this.logSuccess=function(e){this.fireEvent(e,n.successSuffix),this.endStatisticsSequenceWithSuccess(c(e+this.provider+n.completedTimeSequenceSuffix))},this.logFail=function(e){this.fireEvent(e,n.failSuffix)},this.logMaxFail=function(e){this.fireEvent(e,n.maxFailSuffix),this.endStatisticsSequenceWithFailure(c(e+this.provider+n.completedTimeSequenceSuffix))},this.logRetried=function(e){this.fireEvent(e,n.retrySuffix)},this.logTriggered=function(e){this.fireEvent(e,n.triggeredSuffix),this.startStatisticsSequence(c(e+this.provider+n.completedTimeSequenceSuffix))},this.logInitialized=function(e){this.fireEvent(e,n.initializedSuffix)},this.logSuppressed=function(e){this.fireEvent(e,n.suppressedSuffix)},this.logDisplayed=function(e){this.fireEvent(e,n.displayedSuffix)},this.logProviderError=function(e){this.fireEvent(e,n.providerErrorSuffix)},this.logCaptchaShownEventToEventStream=function(e){this.logCaptchaInitiatedEventToEventStream(e,n.captchaInitiatedChallengeTypes.visible)},this.logCaptchaSuppressedEventToEventStream=function(e){this.logCaptchaInitiatedEventToEventStream(e,n.captchaInitiatedChallengeTypes.hidden)},this.logCaptchaErrorEventToEventStream=function(e){this.logCaptchaInitiatedEventToEventStream(e,n.captchaInitiatedChallengeTypes.error)},this.logCaptchaInitiatedEventToEventStream=function(e,t){if(Roblox.EventStream){var a=e;Roblox.EventStream.SendEventWithTarget(n.eventStreamCaptchaInitiatedEventName,a,{type:t,provider:this.provider},Roblox.EventStream.TargetTypes.WWW)}},this.logCaptchaTokenReceivedEventToEventStream=function(e,t){if(Roblox.EventStream){var a=e;Roblox.EventStream.SendEventWithTarget(n.eventStreamCaptchaTokenReceivedEventName,a,{provider:this.provider,session:t},Roblox.EventStream.TargetTypes.WWW)}},this.logCaptchaEventToEventStream=function(e,t,a,i){if(Roblox.EventStream){t=t||0;var o=a?"true":"false",c=e;Roblox.EventStream.SendEventWithTarget(n.eventStreamCaptchaEventName,c,{solveDuration:t,success:o,provider:this.provider,session:i||""},Roblox.EventStream.TargetTypes.WWW)}}},(Roblox=Roblox||{}).FunCaptcha=function(){var e,t=[],a=($.extend({},Roblox.CaptchaConstants.messages),"#FunCaptcha-Token"),n=0,i=new Roblox.CaptchaLogger("FunCaptcha"),o={},c={},r={cType:null,tokenValidationRetries:0,extraValidationParams:{},solvedCb:$.noop,loadedCb:$.noop,supressCb:$.noop,shownCb:$.noop,successCb:$.noop,errorCb:$.noop,fcInstance:null};function s(e){for(var a=0;a<t.length;a++)if(t[a].Type===e)return t[a];return null}function p(e){c[e]&&c[e].fcInstance.refresh_session()}function l(t,o){if(i.logTriggered(o.cType),c[t]&&c[t].fcInstance)return p(t),t;var u=function(e,t){var a=$.extend({},r,t);return c[e]=a,a}(t,o);e=h(),i.logInitialized(u.cType);try{u.fcInstance=new FunCaptcha({public_key:s(u.cType).PublicKey,target_html:t,callback:function(){var o=null;e&&(o=h()-e,i.logSolveTime(u.cType,o),e=null);var c=$(a).val();i.logCaptchaTokenReceivedEventToEventStream(u.cType,c),function(e,t,a,o){var c={fcToken:a};c=$.extend({},c,e.extraValidationParams),$.ajax({method:"POST",data:c,url:s(e.cType).ApiUrl,success:function(){i.logSuccess(e.cType),i.logCaptchaEventToEventStream(e.cType,o,!0,a),e.successCb()},error:function(){i.logFail(e.cType),e.tokenValidationRetries<n?(e.tokenValidationRetries+=1,i.logRetried(e.cType),l(t,e)):(i.logMaxFail(e.cType),i.logCaptchaEventToEventStream(e.cType,o,!1,a),e.errorCb())}})}(u,t,c,o),u.solvedCb()},loaded_callback:u.loadedCb,onsuppress:function(){var e;e=u.cType,i.logSuppressed(e),i.logCaptchaSuppressedEventToEventStream(e),u.suppressCb()},onshown:function(){var e;e=u.cType,i.logDisplayed(e),i.logCaptchaShownEventToEventStream(e),u.shownCb()}})}catch(e){i.logProviderError(u.cType),i.logCaptchaErrorEventToEventStream(u.cType),u.errorCb&&u.errorCb(0,e)}return t}function u(){var e=$("#game-card-redeem-captcha").addClass("hidden").detach();$("#redeem-card-wrapper").append(e),Roblox.Dialog.close()}function h(){return(new Date).valueOf()}return{types:$.extend({},Roblox.CaptchaConstants.types),setMaxRetriesOnTokenValidationFailure:function(e){n=e},reset:p,render:l,addCaptchaTypes:function(e,a){e&&e.forEach(function(e){var n,i={Type:a?(n=e.Type,n.charAt(0).toLowerCase()+n.slice(1)):e.Type,ApiUrl:e.ApiUrl,PublicKey:e.PublicKey},c=JSON.stringify(i);o.hasOwnProperty(c)||(o[c]=i,t.push(i))})},setPerAppTypeLoggingEnabled:function(e){i.setPerAppTypeLoggingEnabled(e)},showFunCaptchaInModal:function(){Roblox.Dialog.open({bodyContent:'<div id="funcaptcha-modal-body" class="funcaptcha-modal-body"></div>',allowHtmlContentInBody:!0,showAccept:!1,showDecline:!1,xToCancel:!0,onCloseCallback:u});var e=$("#game-card-redeem-captcha").removeClass("hidden").detach();$("#funcaptcha-modal-body").append(e)},dismissFunCaptchaModal:u,captchaInstances:c,loggerInstance:i}}();var captchaV2=captchaV2||angular.module("captchaV2",["captchaV2Templates"]);captchaV2.constant("captchaV2Constants",{urls:{getMetadata:Roblox.EnvironmentUrls.captchaApi+"/v1/captcha/metadata",funCaptchaRedeem:{WebSignup:Roblox.EnvironmentUrls.captchaApi+"/v1/funcaptcha/signup/web",AppSignup:Roblox.EnvironmentUrls.captchaApi+"/v1/funcaptcha/signup/app",WebLogin:Roblox.EnvironmentUrls.captchaApi+"/v1/funcaptcha/login/web",AppLogin:Roblox.EnvironmentUrls.captchaApi+"/v1/funcaptcha/login/app",UserAction:Roblox.EnvironmentUrls.captchaApi+"/v1/funcaptcha/user"}},captchaActionTypes:{login:"login",appLogin:"appLogin",signup:"signup",appSignup:"appSignup",groupJoin:"groupJoin"},funCaptchaCaptchaTypes:{login:"Login",appLogin:"AppLogin",signup:"Signup",appSignup:"AppSignup",groupJoin:"JoinGroup"},funCaptchaPublicKeyMap:{Login:"WebLogin",AppLogin:"AppLogin",Signup:"WebSignup",AppSignup:"AppSignup",JoinGroup:"UserAction"},funCaptchaEvents:{resolve:"resolve",reject:"reject",shown:"shown"},errorCodes:{internal:{unknown:0,missingPrivateKey:1,missingActionType:2}}}),captchaV2.factory("captchaV2Service",["$q","httpService","captchaV2Constants",function(e,t,a){var n=0,i=null;return{getMetadata:function(){return e(function(e,n){if(i)e(i);else{var o={url:a.urls.getMetadata};t.httpGet(o).then(function(t){i=t,e(t)},n)}})},getCaptchaId:function(){return"captchaV2-"+ ++n}}}]),captchaV2.factory("funCaptchaService",["$q","$log","$window","captchaV2Constants","captchaV2Service",function(e,t,a,n,i){var o={},c=function(e,t,a){o.hasOwnProperty(e)&&o[e].forEach(function(e){e.name===t&&e.handle(a)})},r=function(e,t,a){a&&(o[e]=o[e]||[],o[e].push({name:t,handle:a}))},s=function(e){o[e]=[]};return i.getMetadata().then(function(e){var i={},o=[];for(var c in e.funCaptchaPublicKeys.forEach(function(e){i[e.type]=e.value}),n.funCaptchaPublicKeyMap){if(!n.funCaptchaPublicKeyMap.hasOwnProperty(c))return;var r=n.funCaptchaPublicKeyMap[c];if(r&&i.hasOwnProperty(r)){var s=n.urls.funCaptchaRedeem[r];s&&o.push({Type:c,ApiUrl:s,PublicKey:i[r]})}else t.warn("Missing public key for: "+c+"\n\tpublicKeyType: "+r)}t.debug("Add captcha types:",o),a.Roblox.FunCaptcha.addCaptchaTypes(o,!1)},function(){t.debug("Failed to load captcha metadata for funCaptchaService. FunCaptcha will not work properly.")}),{render:function(i,o,p){return e(function(e,l){var u=n.funCaptchaCaptchaTypes[o],h="\n\telementId: "+i+"\n\tcaptchaActionType: "+o+"\n\tfunCaptchaType: "+u;if(t.debug("Render captcha"+h),!u)return t.warn("Missing funCaptchaType for "+o),void l(n.errorCodes.internal.missingActionType);r(u,n.funCaptchaEvents.resolve,e),r(u,n.funCaptchaEvents.reject,l),r(u,n.funCaptchaEvents.shown,p),a.Roblox.FunCaptcha.render(i,{cType:u,successCb:function(){t.debug("Passed captcha"+h),c(u,n.funCaptchaEvents.resolve),s(u)},shownCb:function(){t.debug("Captcha shown"+h),c(u,n.funCaptchaEvents.shown)},errorCb:function(e,a){a?t.error("Failed captcha ("+e+":) "+a+h):t.debug("Failed captcha ("+e+")"+h),c(u,n.funCaptchaEvents.reject,n.errorCodes.internal.unknown),s(u)}})})}}}]),captchaV2.controller("captchaV2Controller",["captchaV2Service","funCaptchaService","$scope",function(e,t,a){var n=this,i=!1,o=!1;n.captchaEnded=function(){n.activated=!1,n.shown=!1,i=!1},n.captchaShown=function(){n.shown=!0,a.$apply()},n.hideCaptcha=function(){n.activated=!1},n.getCaptchaClasses=function(){return{"captcha-activated":n.shown&&n.activated}};n.$onInit=function(){n.id||(n.id=e.getCaptchaId()),n.activated&&!i&&(i=!0,t.render(n.id,n.captchaActionType,n.captchaShown).then(function(){n.activated&&n.captchaPassed()(),n.captchaEnded()},function(e){n.activated&&n.captchaFailed()(e),n.captchaEnded()}))},n.$doCheck=function(){o!==n.activated&&(o=n.activated,n.$onInit())}.bind(n)}]),captchaV2.component("captcha",{templateUrl:"captcha",bindings:{activated:"=",captchaActionType:"<",captchaPassed:"&",captchaFailed:"&"},controller:"captchaV2Controller"});