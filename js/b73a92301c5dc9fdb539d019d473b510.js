;// bundle: chat___1c6042f28ffebb17150da45c8135d552_m
;// files: angular/angular.audio.js, angular/angular-elastic.js, ~/viewapp/common/constants/callBackTypes.js, ~/viewapp/common/constants/deviceTypes.js, ~/viewapp/common/constants/performanceMarkLabels.js, ~/viewapp/pages/chat/chat.js, ~/viewapp/pages/chat/constants/chatLayoutText.js, ~/viewapp/pages/chat/constants/dialogAttributes.js, ~/viewapp/pages/chat/constants/notificationsName.js, ~/viewapp/pages/chat/constants/notificationType.js, ~/viewapp/pages/chat/constants/resources.js, ~/viewapp/pages/chat/constants/userPresenceTypes.js, ~/viewapp/pages/chat/services/chatService.js, ~/viewapp/pages/chat/services/partyService.js, ~/viewapp/pages/chat/services/messageService.js, ~/viewapp/pages/chat/services/cookieService.js, ~/viewapp/pages/chat/services/chatUtilityService.js, ~/viewapp/pages/chat/services/chatClientStorageUtilityService.js, ~/viewapp/pages/chat/services/chatHybridService.js, ~/viewapp/pages/chat/directives/chatDataDirective.js, ~/viewapp/pages/chat/controllers/chatController.js, ~/viewapp/pages/chat/controllers/dialogsController.js, ~/viewapp/pages/chat/directives/chatBarDirective.js, ~/viewapp/pages/chat/directives/lazyLoadDirective.js, ~/viewapp/pages/chat/directives/dialogDirective.js, ~/viewapp/pages/chat/directives/groupSelectDirective.js, ~/viewapp/pages/chat/directives/abuseReportDirective.js, ~/viewapp/pages/chat/directives/confirmNegativeActionDirective.js, ~/viewapp/pages/chat/directives/friendsSelectionDirective.js, ~/viewapp/pages/chat/controllers/dialogController.js, ~/viewapp/pages/chat/directives/dialogLazyLoadDirective.js, ~/viewapp/pages/chat/directives/dialogMinimizeDirective.js, ~/viewapp/pages/chat/directives/minimizeItemDirective.js, ~/viewapp/pages/chat/directives/chatSettingDirective.js, ~/viewapp/pages/chat/controllers/friendsController.js, ~/viewapp/pages/chat/directives/friendsLazyLoadDirective.js, ~/viewapp/pages/chat/directives/backBtnDirective.js, ~/viewapp/pages/chat/directives/removeFocusDirective.js, ~/viewapp/pages/chat/directives/chatPlaceholderDirective.js

;// angular/angular.audio.js
"use strict";angular.module("ngAudio",[]).directive("ngAudio",["$compile","$q","ngAudio",function(n,t,i){return{restrict:"AEC",scope:{volume:"=",start:"=",currentTime:"=",loop:"=",clickPlay:"=",disablePreload:"="},controller:function(n,t,r,u){function e(){f=i.load(t.ngAudio,n),n.$audio=f,f.unbind()}var f;n.disablePreload||e();r.on("click",function(){n.clickPlay!==!1&&(n.disablePreload&&e(),f.audio.play(),f.volume=n.volume||f.volume,f.loop=n.loop,f.currentTime=n.start||0,u(function(){f.play()},5))});r.on("$destroy",function(){f.destroy()})}}}]).directive("ngAudioHover",["$compile","$q","ngAudio",function(n,t,i){return{restrict:"AEC",controller:function(n,t,r){var f=i.load(t.ngAudioHover,n);r.on("mouseover rollover hover",function(){f.audio.play(),f.volume=t.volumeHover||f.volume,f.loop=t.loop,f.currentTime=t.startHover||0});r.on("$destroy",function(){f.destroy()})}}}]).service("localAudioFindingService",["$q",function(n){this.find=function(t){var i=n.defer(),r=document.getElementById(t);return r?i.resolve(r):i.reject(t),i.promise}}]).service("remoteAudioFindingService",["$q",function(n){this.find=function(t){var r=n.defer(),i=new Audio;return i.addEventListener("error",function(){r.reject()}),i.addEventListener("loadstart",function(){r.resolve(i)}),setTimeout(function(){i.src=t},1),r.promise}}]).service("cleverAudioFindingService",["$q","localAudioFindingService","remoteAudioFindingService",function(n,t,i){this.find=function(r){var u=n.defer();return r=r.replace("|","/"),t.find(r).then(u.resolve,function(){return i.find(r)}).then(u.resolve,u.reject),u.promise}}]).value("ngAudioGlobals",{muting:!1,songmuting:!1,performance:25,unlock:!0}).factory("NgAudioObject",["cleverAudioFindingService","$rootScope","$interval","$timeout","ngAudioGlobals",function(n,t,i,r,u){return function(r,f){function d(){o.play(),o.pause(),window.removeEventListener("click",d)}function rt(){w||(h&&i.cancel(h),k&&k(),s&&s(),w=!0)}function ft(){w||(s=b.$watch(function(){return{volume:e.volume,currentTime:e.currentTime,progress:e.progress,muting:e.muting,loop:e.loop,playbackRate:e.playbackRate}},function(n,t){n.currentTime!==t.currentTime&&e.setCurrentTime(n.currentTime),n.progress!==t.progress&&e.setProgress(n.progress),n.volume!==t.volume&&e.setVolume(n.volume),n.playbackRate!==t.playbackRate&&e.setPlaybackRate(n.playbackRate),l=n.loop,n.muting!==t.muting&&e.setMuting(n.muting)},!0))}function ut(){s&&s(),o&&(o.volume=p||u.isMuting?0:e.volume!==undefined?e.volume:1,y&&(o.play(),y=!1),nt&&(o.pause(),o.currentTime=0,nt=!1),v&&(o.pause(),v=!1),a&&(o.playbackRate=tt,a=!1),c&&(o.volume=c,c=undefined),it&&(e.currentTime=o.currentTime,e.duration=o.duration,e.remaining=o.duration-o.currentTime,e.progress=o.currentTime/o.duration,e.paused=o.paused,e.src=o.src,e.currentTime>=e.duration&&g.forEach(function(n){n(e)}),l&&e.currentTime>=e.duration&&(l!==!0&&(l--,e.loop--),e.setCurrentTime(0),e.play())),p||u.isMuting||(e.volume=o.volume),e.audio=o),ft()}var s,k,y=!1,v=!1,nt=!1,a=!1,tt=!1,c,l,p=!1,it=!0,w=!1,b=f||t,o,e=this,g,h;this.id=r,this.safeId=r.replace("/","|"),this.loop=0,this.unbind=function(){it=!1},this.play=function(){return y=!0,this},g=[],this.complete=function(n){g.push(n)},this.pause=function(){v=!0},this.restart=function(){nt=!0},this.stop=function(){this.restart()},this.setVolume=function(n){c=n},this.setPlaybackRate=function(n){tt=n,a=!0},this.setMuting=function(n){p=n},this.setProgress=function(n){o&&o.duration&&isFinite(n)&&(o.currentTime=o.duration*n)},this.setCurrentTime=function(n){o&&o.duration&&(o.currentTime=n)},this.destroy=rt,b.$on("$destroy",function(){rt()}),n.find(r).then(function(n){o=n,u.unlock&&(window.addEventListener("click",d),o.addEventListener("playing",function(){window.removeEventListener("click",d)})),o.addEventListener("canplay",function(){e.canPlay=!0})},function(n){e.error=!0,console.warn(n)}),h=i(ut,u.performance),k=b.$watch(function(){return u.performance},function(){i.cancel(h),h=i(ut,u.performance)})}}]).service("ngAudio",["NgAudioObject","ngAudioGlobals",function(n,t){this.play=function(t,i){var r=new n(t,i);return r.play(),r},this.load=function(t,i){return new n(t,i)},this.mute=function(){t.muting=!0},this.unmute=function(){t.muting=!1},this.toggleMute=function(){t.muting=!t.muting},this.setUnlock=function(n){t.unlock=n}}]).filter("trackTime",function(){return function(n){var t=Math.floor(n|0),f="",u=0,i=0,r=0;return t>3599?(u=Math.floor(t/3600),i=Math.floor((t-u*3600)/60),r=t-(i*60+u*3600),u.toString().length==1&&(u="0"+Math.floor(t/3600).toString()),i.toString().length==1&&(i="0"+Math.floor((t-u*3600)/60).toString()),r.toString().length==1&&(r="0"+(t-(i*60+u*3600)).toString()),f=u+":"+i+":"+r):t>59?(i=Math.floor(t/60),r=t-i*60,i.toString().length==1&&(i="0"+Math.floor(t/60).toString()),r.toString().length==1&&(r="0"+(t-i*60).toString()),f=i+":"+r):(r=t,r.toString().length==1&&(r="0"+t.toString()),f=t+"s"),typeof Number.isNaN=="function"&&Number.isNaN(f),f}});

;// angular/angular-elastic.js
typeof module!="undefined"&&typeof exports!="undefined"&&module.exports===exports&&(module.exports="monospaced.elastic"),angular.module("monospaced.elastic",[]).constant("msdElasticConfig",{append:""}).directive("msdElastic",["$timeout","$window","msdElasticConfig",function(n,t,i){"use strict";return{require:"ngModel",restrict:"A, C",link:function(r,u,f,e){function nt(){var n=b;g=o,s=getComputedStyle(o),angular.forEach(ot,function(t){n+=t+":"+s.getPropertyValue(t)+";"}),h.setAttribute("style",n)}function y(){var u,i,t,f,e;g!==o&&nt(),a||(a=!0,h.value=o.value+et,h.style.overflowY=o.style.overflowY,u=o.style.height===""?"auto":parseInt(o.style.height,10),i=getComputedStyle(o).getPropertyValue("width"),i.substr(i.length-2,2)==="px"&&(f=parseInt(i,10)-p.width,h.style.width=f+"px"),t=h.scrollHeight,t>c?(t=c,e="scroll"):t<k&&(t=k),t+=p.height,o.style.overflowY=e||"hidden",u!==t&&(r.$emit("elastic:resize",v,u,t),o.style.height=t+"px"),n(function(){a=!1},1))}function l(){a=!1,y()}var o=u[0],v=u,it;if(o.nodeName==="TEXTAREA"&&t.getComputedStyle){v.css({overflow:"hidden","overflow-y":"hidden","word-wrap":"break-word"}),it=o.value,o.value="",o.value=it;var et=f.msdElastic?f.msdElastic.replace(/\\n/g,"\n"):i.append,d=angular.element(t),b="position: absolute; top: -999px; right: auto; bottom: auto;left: 0; overflow: hidden; -webkit-box-sizing: content-box;-moz-box-sizing: content-box; box-sizing: content-box;min-height: 0 !important; height: 0 !important; padding: 0;word-wrap: break-word; border: 0;",tt=angular.element('<textarea aria-hidden="true" tabindex="-1" style="'+b+'"/>').data("elastic",!0),h=tt[0],s=getComputedStyle(o),w=s.getPropertyValue("resize"),rt=s.getPropertyValue("box-sizing")==="border-box"||s.getPropertyValue("-moz-box-sizing")==="border-box"||s.getPropertyValue("-webkit-box-sizing")==="border-box",p=rt?{width:parseInt(s.getPropertyValue("border-right-width"),10)+parseInt(s.getPropertyValue("padding-right"),10)+parseInt(s.getPropertyValue("padding-left"),10)+parseInt(s.getPropertyValue("border-left-width"),10),height:parseInt(s.getPropertyValue("border-top-width"),10)+parseInt(s.getPropertyValue("padding-top"),10)+parseInt(s.getPropertyValue("padding-bottom"),10)+parseInt(s.getPropertyValue("border-bottom-width"),10)}:{width:0,height:0},ut=parseInt(s.getPropertyValue("min-height"),10),ft=parseInt(s.getPropertyValue("height"),10),k=Math.max(ut,ft)-p.height,c=parseInt(s.getPropertyValue("max-height"),10),g,a,ot=["font-family","font-size","font-weight","font-style","letter-spacing","line-height","text-transform","word-spacing","text-indent"];v.data("elastic")||(c=c&&c>0?c:9e4,h.parentNode!==document.body&&angular.element(document.body).append(h),v.css({resize:w==="none"||w==="vertical"?"none":"horizontal"}).data("elastic",!0),o.oninput="onpropertychange"in o&&"oninput"in o?o.onkeyup=y:y,d.bind("resize",l),r.$watch(function(){return e.$modelValue},function(){l()}),r.$on("elastic:adjust",function(){nt(),l()}),n(y),r.$on("$destroy",function(){tt.remove(),d.unbind("resize",l)}))}}}}]);

;// ~/viewapp/common/constants/callBackTypes.js
robloxApp.constant("callBackTypes",{SUCCESS:"Success",MODERATED:"Moderated"});

;// ~/viewapp/common/constants/deviceTypes.js
robloxApp.constant("deviceTypes",{COMPUTER:"Computer",PHONE:"Phone",TABLET:"Tablet"});

;// ~/viewapp/common/constants/performanceMarkLabels.js
robloxApp.constant("performanceMarkLabels",{chat:{chatPageDataLoaded:"chat_pageData_loaded",chatConversationsLoading:"chat_conversations_loading",chatConversationsLoaded:"chat_conversations_loaded",chatSignalRInitializing:"chat_signalR_initializing",chatSignalRSucceeded:"chat_signalR_succeeded"}});

;// ~/viewapp/pages/chat/chat.js
"use strict";var chat=angular.module("chat",["robloxApp.helpers","monospaced.elastic","ngAudio"]).config(["msdElasticConfig",function(n){n.append="\n"}]);

;// ~/viewapp/pages/chat/constants/chatLayoutText.js
chat.constant("chatLayoutText",{groupChat:{layoutId:"newGroup",title:"Create Group"},party:{partyName:"Party",partyInviteMsg:"PARTY INVITE!",partyLeaderTooltip:" is the party leader",partyMemberTooltip:" is in the party",pendingMemberTooltip:" is not in the party",memberJoinText:" joined the party",joinPartyText:"The party leader is finding a game to play.",createPartyText:" to play with your friends!",conversationTitleChangedText:" named the chat group: "},newParty:{layoutId:"newParty",title:"Create Party",partyName:"Party : "},errorMessges:{conversationTitleModerated:"Chat group name was moderated.",messageContentModerated:"Content was moderated."}});

;// ~/viewapp/pages/chat/constants/dialogAttributes.js
chat.constant("dialogAttributes",{dialogTypes:{FRIEND:-1,CHAT:0,GROUPCHAT:1,NEWGROUPCHAT:2,PARTY:3,NEWPARTY:4,PENDINGPARTY:5,ADDFRIENDS:6},dialogStatus:{INIT:0,OPEN:1,REPLACE:2,MINIMIZE:3,COLLAPSE:4,REMOVE:5,REFRESH:6},scrollBarTypes:{MESSAGE:0,FRIENDSELECTION:1},activeType:{NEWMESSAGE:"New message",PARTYINVITE:"Party Invite"},memberStatus:{PENDING:0,MEMBER:1,LEADER:2},dialogBannerTypes:{"default":-1,member:0,game:1},negativeAction:{removeUser:{title:"Remove User?",btnName:"Remove",type:"removeUser"},leaveChatGroup:{title:"Leave Chat Group?",btnName:"Leave",type:"leaveChatGroup"}},conversationType:{oneToOneConversation:"OneToOneConversation",multiUserConversation:"MultiUserConversation",cloudEditConversation:"CloudEditConversation"},participantType:{user:"User"}});

;// ~/viewapp/pages/chat/constants/notificationsName.js
chat.constant("notificationsName",{ChatNotifications:"ChatNotifications",PartyNotifications:"PartyNotifications",FriendshipNotifications:"FriendshipNotifications",PresenceNotifications:"PresenceNotifications",ChatPrivacySettingNotifications:"ChatPrivacySettingNotifications"});

;// ~/viewapp/pages/chat/constants/notificationType.js
chat.constant("notificationType",{newMessage:"NewMessage",newMessageBySelf:"NewMessageBySelf",newConversation:"NewConversation",addedToConversation:"AddedToConversation",removedFromConversation:"RemovedFromConversation",participantAdded:"ParticipantAdded",participantLeft:"ParticipantLeft",invitedToParty:"InvitedToParty",partyUserJoined:"PartyUserJoined",partyUserLeft:"PartyUserLeft",iLeftParty:"ILeftParty",partyJoinedGame:"PartyJoinedGame",partyLeftGame:"PartyLeftGame",partyDeleted:"PartyDeleted",iCreatedParty:"ICreatedParty",iJoinedParty:"IJoinedParty",friendshipDestroyed:"FriendshipDestroyed",friendshipCreated:"FriendshipCreated",presenceOffline:"UserOffline",presenceOnline:"UserOnline",conversationTitleModerated:"ConversationTitleModerated",chatEnabled:"ChatEnabled",chatDisabled:"ChatDisabled",conversationTitleChanged:"ConversationTitleChanged"});

;// ~/viewapp/pages/chat/constants/resources.js
chat.constant("resources",{templates:{chatBarTemplate:"chat-bar",abuseReportTemplate:"chat-abuse-report",dialogTemplate:"chat-dialog",friendsSelectionTemplate:"chat-friends-selection",groupDialogTemplate:"chat-group-dialog",newGroupTemplate:"chat-new-group",dialogMinimizeTemplate:"chat-dialog-minimize",chatPlaceholderTemplate:"chat-placeholder",confirmNegativeActionTemplate:"confirm-negative-action"}});

;// ~/viewapp/pages/chat/constants/userPresenceTypes.js
chat.constant("userPresenceTypes",[{className:"",title:"Offline"},{className:"online",title:"Online"},{className:"game",title:"In Game"},{className:"studio",title:"In Studio"}]);

;// ~/viewapp/pages/chat/services/chatService.js
"use strict";chat.factory("chatService",["$q","partyService","chatUtility","chatClientStorageUtilityService","httpService","$log",function(n,t,i,r,u,f){var e={},s={},g=["avatar","presence"],o={avatar:{name:"AvatarThumb",type:"avatar",multiGetUrl:"/thumbnail/avatar-headshots",endpointType:"Avatar"},presence:{name:"UserPresenceType",type:"presence",multiGetUrl:"/presence/users",endpointType:"Presence"}},y=100,v=100,p=function(n){return e[n]&&angular.isDefined(e[n].AvatarThumb)},a=function(n){return e[n]&&angular.isDefined(e[n].UserPresenceType)},w=function(n){return p(n)&&a(n)},b=function(n,t){var i={userIds:t},r={url:n,withCredentials:!0,retryable:!0};return u.httpGet(r,i,!0)},l=function(n,t,i,r){for(var u=0,e=o[n],f=t.slice(u,parseInt(r)),s;f.length>0;)i.push(b(e.multiGetUrl,f)),s=i.length-1,u++,f=t.slice(u*r,u*r+r)},c=function(n){var u=[],i=[],r=[],t;return angular.forEach(n,function(n){var t=n.userId;(!s.IsLoadingExistedPresenceInfoFromClientSideInChatEnabled||a(t))&&s.IsLoadingExistedPresenceInfoFromClientSideInChatEnabled||r.push(t),(!s.IsLoadingExistedAvatarInfoFromClientSideInChatEnabled||p(t))&&s.IsLoadingExistedAvatarInfoFromClientSideInChatEnabled||i.push(t),u.push(t)}),t=[],l(o.avatar.type,i,t,y),l(o.presence.type,r,t,v),t},d=function(n,t){for(var s=[],u,i,f,r=0;r<t.length;r++)i=t[r].data,i&&i.length>0&&i[0].EndpointType===o[n].endpointType&&(s=s.concat(i));for(u=o[n].name,r=0;r<s.length;r++)i=s[r],f=i.UserId,e[f]||(e[f]={}),e[f][u]=u===o.presence.name?i[u]:i;return e},h=function(n,t){var u,r,i;angular.forEach(g,function(t){d(t,n)});for(u in t)r=t[u],i=r.userId,e[i]||(e[i]={}),e[i].Id=i,e[i].userId=i,e[i].name=r.name,r[o.avatar.name]=e[i][o.avatar.name],r[o.presence.name]=e[i][o.presence.name],Roblox&&Roblox.Endpoints&&(e[i].UserProfileLink=Roblox.Endpoints.generateAbsoluteUrl("/users/{id}/profile",{id:i},!0));return t},nt=function(n){if(n.length===0)return[];var i={conversationIds:n},r={url:t.apiSets.getPartiesForConversationsApi.url,withCredentials:!0,retryable:!0};return u.httpGet(r,i,!0)},tt=function(t,r){var u=[],f;return i.isInApp()||(u=u.concat(nt(t))),f=(+new Date).toString(),u=u.concat(c(r,f)),n.all(u).then(function(n){var u={parties:[]},f,e;return n&&n.length>0&&(f=t.length>0&&!i.isInApp()?n[0].data:[],e=i.isInApp()?n:n.slice(1),h(e,r),u={parties:f}),u})},k=function(t){var i=c(t);return n.all(i).then(function(n){return h(n,t),t})},it=function(n){var t=null;if(n)t=n;else{var u=r.getFromStorage(r.storageDictionary.chatFriendsListReloadTime),e=+new Date,f=u?(e-u)/1e3:null;f&&f<i.friendsListOutputCacheDurationInSeconds&&(t=u)}return t};return{invitedParties:[],apiSets:{getDataUrl:{url:"/chat/data",retryable:!0},getFriendListUrl:{url:"/friends/list",retryable:!0,withCredentials:!0},getUserAvatarUrl:{url:"/thumbnail/avatar-headshot",retryable:!0},getPresenceUserUrl:{url:"/presence/user",retryable:!0}},setChatData:function(n){s=n},setParams:function(n){this.apiSets.markAsReadApi={url:n+"/v2/mark-as-read",retryable:!1,withCredentials:!0},this.apiSets.markAsSeenApi={url:n+"/v2/mark-as-seen",retryable:!1,withCredentials:!0},this.apiSets.sendMessageApi={url:n+"/v2/send-message",retryable:!1,withCredentials:!0},this.apiSets.conversationsApi={url:n+"/v2/get-conversations",retryable:!0,withCredentials:!0},this.apiSets.userConversationsApi={url:n+"/v2/get-user-conversations",retryable:!0,withCredentials:!0},this.apiSets.unreadConversationsApi={url:n+"/v2/get-unread-conversations",retryable:!0,withCredentials:!0},this.apiSets.getMessagesApi={url:n+"/v2/get-messages",retryable:!0,withCredentials:!0},this.apiSets.multiGetLatestMessagesApi={url:n+"/v2/multi-get-latest-messages",retryable:!0,withCredentials:!0},this.apiSets.unreadMessagesApi={url:n+"/v2/get-unread-messages",retryable:!0,withCredentials:!0},this.apiSets.getUnreadConversationCountApi={url:n+"/v2/get-unread-conversation-count",retryable:!0,withCredentials:!0},this.apiSets.startOneToOneConversationApi={url:n+"/v2/start-one-to-one-conversation",retryable:!0,withCredentials:!0},this.apiSets.startGroupConversationApi={url:n+"/v2/start-group-conversation",retryable:!1,withCredentials:!0},this.apiSets.addToConversationApi={url:n+"/v2/add-to-conversation",retryable:!0,withCredentials:!0},this.apiSets.removeFromConversationApi={url:n+"/v2/remove-from-conversation",retryable:!0,withCredentials:!0},this.apiSets.renameGroupConversationApi={url:n+"/v2/rename-group-conversation",retryable:!1,withCredentials:!0}},setAvatarHeadshotsMultigetLimit:function(n){y=parseInt(n)},setUserPresenceMultigetLimit:function(n){v=parseInt(n)},getFriendsDict:function(){return e},getUnreadConversationCount:function(){return u.httpGet(this.apiSets.getUnreadConversationCountApi,null)},getUnreadConversations:function(t,r,e){var o=this,s={pageNumber:t,pageSize:r};return u.httpGet(this.apiSets.unreadConversationsApi,s).then(function(t){var r=t;if(r.isGroupChat=t.conversationType===i.conversationType.multiUserConversation,r.length>0){var u={},h=[],s=[];return r.forEach(function(n){h.push(n.id),u[n.id]=n,s.push(o.getMessages(n.id,null,e).then(function(t){return{messages:t,conversationId:n.id}}))}),n.all(s).then(function(n){var t=[];return angular.forEach(n,function(n){var o=n.conversationId,f=n.messages,e=u[o];e.chatMessages=f,f.length>0?(i.sanitizeMessage(f[0]),e.displayMessage=f[0]):e.displayMessage=[],t.push(e)}),t},function(){f.debug("------------ get messages request failed -------------")})}return null})},getUserConversations:function(r,e){var s={pageNumber:r,pageSize:e},o=[u.httpGet(this.apiSets.userConversationsApi,s,!0)];return i.isInApp()||o.push(u.httpGet(t.apiSets.getCurrentPartyApi,null,!0)),n.all(o).then(function(n){var f=[],e=[],o=[],t={},r=[],u;return n&&n.length>0&&(r=n[0].data?n[0].data:[],u=n[1]&&n[1].data?n[1].data:[],r.forEach(function(n){n.isGroupChat=n.conversationType===i.conversationType.multiUserConversation,angular.forEach(n.participants,function(n){n.userId=n.targetId;var t=n.targetId;f.indexOf(t)<0&&!w(t)&&(f.push(t),e.push(n))}),u&&u.ConversationId===n.id&&(n.party=u,n.dialogType=i.dialogType.PARTY),n.dialogType||(n.dialogType=n.isGroupChat?i.dialogType.GROUPCHAT:i.dialogType.CHAT),o.push(n.id),t[n.id]=n})),tt(o,e).then(function(n){var u=n.parties;return u&&u.length>0&&u.forEach(function(n){t[n.ConversationId]&&!t[n.ConversationId].party&&(t[n.ConversationId].party=n,t[n.ConversationId].dialogType=i.dialogType.PENDINGPARTY)}),r},function(){return r})},function(){f.debug("------------ get user conversation request failed -------------")})},getUserInfo:function(t){var i={userId:t.userId};return n.all([u.httpGet(this.apiSets.getUserAvatarUrl,i,!0),u.httpGet(this.apiSets.getPresenceUserUrl,i,!0)]).then(function(n){var i=n[0].data,r=n[1].data;return t.AvatarThumb=i,t.UserPresenceType=r.UserPresenceType,Roblox&&Roblox.Endpoints&&(t.UserProfileLink=Roblox.Endpoints.generateAbsoluteUrl("/users/{id}/profile",{id:t.userId},!0)),t})},getUserPresence:function(n){var t={userId:n.userId};return u.httpGet(this.apiSets.getPresenceUserUrl,t)},getFriends:function(n,t,i,r){var f={userId:n,startIndex:t,pageSize:i},e=it(r);return e&&(f.timeStamp=e),u.httpGet(this.apiSets.getFriendListUrl,f).then(function(n){if(angular.isDefined(n.Friends)&&n.Friends.length>0){for(var t=0;t<n.Friends.length;t++)n.Friends[t].userId=n.Friends[t].Id,n.Friends[t].name=n.Friends[t].Username;return k(n.Friends)}return null})},getConversations:function(n){var t={conversationIds:n};return u.httpGet(this.apiSets.conversationsApi,t)},addToConversation:function(n,t){var i={participantUserIds:n,conversationId:t};return u.httpPost(this.apiSets.addToConversationApi,i)},removeFromConversation:function(n,t){var i={participantUserId:n,conversationId:t};return u.httpPost(this.apiSets.removeFromConversationApi,i)},startOneToOneConversation:function(n){var t={participantUserId:n};return u.httpPost(this.apiSets.startOneToOneConversationApi,t)},startGroupConversation:function(n){var t={participantUserIds:n};return u.httpPost(this.apiSets.startGroupConversationApi,t)},getMessages:function(n,t,i){var r={conversationId:n,exclusiveStartMessageId:t,pageSize:i};return u.httpGet(this.apiSets.getMessagesApi,r)},multiGetLatestMessages:function(n,t){var i={conversationIds:n,pageSize:t};return u.httpGet(this.apiSets.multiGetLatestMessagesApi,i)},markAsRead:function(n,t){var i={conversationId:n,endMessageId:t};return u.httpPost(this.apiSets.markAsReadApi,i)},markAsSeen:function(n){var t={conversationsToMarkSeen:n};return u.httpPost(this.apiSets.markAsSeenApi,t)},sendMessage:function(n,t){var i={conversationId:n,message:t};return u.httpPost(this.apiSets.sendMessageApi,i)},setup:function(){return u.httpGet(this.apiSets.getDataUrl)},renameGroupConversation:function(n,t){var i={conversationId:n,newTitle:t};return u.httpPost(this.apiSets.renameGroupConversationApi,i)}}}]);

;// ~/viewapp/pages/chat/services/partyService.js
"use strict";chat.factory("partyService",["chatHybridService","$document","httpService","$log",function(n,t,i){return{apiSets:{getPlaceUrl:{url:"/thumbnail/place",retryable:!0}},setParams:function(n){this.apiSets.partyCreateApi={url:n+"/v1.0/party/create",retryable:!1,withCredentials:!0},this.apiSets.partyInviteApi={url:n+"/v1.0/party/invite",retryable:!0,withCredentials:!0},this.apiSets.partyLeaveApi={url:n+"/v1.0/party/leave",retryable:!0,withCredentials:!0},this.apiSets.partyJoinApi={url:n+"/v1.0/party/join",retryable:!0,withCredentials:!0},this.apiSets.getInvitedPartiesApi={url:n+"/v1.0/party/get-invites",retryable:!0,withCredentials:!0},this.apiSets.getCurrentPartyApi={url:n+"/v1.0/party/get-current",retryable:!0,withCredentials:!0},this.apiSets.removeFromPartyApi={url:n+"/v1.0/party/remove-from-party",retryable:!0,withCredentials:!0},this.apiSets.getPartiesForConversationsApi={url:n+"/v1.0/party/get-parties-for-conversations",retryable:!0,withCredentials:!0}},partyCreate:function(n,t){var r={invitedUserIds:t,conversationId:n};return i.httpPost(this.apiSets.partyCreateApi,r)},partyInvite:function(n,t){var r={invitedUserId:t,partyId:n};return i.httpPost(this.apiSets.partyInviteApi,r)},partyLeave:function(n){var t={partyId:n};return i.httpPost(this.apiSets.partyLeaveApi,t)},partyJoin:function(n){var t={partyId:n};return i.httpPost(this.apiSets.partyJoinApi,t)},getInvitedParties:function(n,t){var r={pageNumber:n,pageSize:t};return i.httpGet(this.apiSets.getInvitedPartiesApi,r)},getPartiesForConversations:function(n){var t={conversationIds:n};return i.httpGet(this.apiSets.getPartiesForConversationsApi,t)},getCurrentParty:function(){return i.httpGet(this.apiSets.getCurrentPartyApi,null)},removeFromParty:function(n,t){var r={partyId:n,userId:t};return i.httpPost(this.apiSets.removeFromPartyApi,r)},getPlace:function(n){var t={placeId:n};return i.httpGet(this.apiSets.getPlaceUrl,t)},joinGame:function(n){var r=n.party,u,f;r.GameId&&r.GamePlaceId&&(t.triggerHandler("Roblox.Chat.PartyInGame",{placeId:r.GamePlaceId}),u="PlaceLauncherStatusPanel",f=angular.element(document.querySelector("#"+u)),this.getPlace(r.GamePlaceId).then(function(t){n.placeThumbnail=t}),Roblox.GamePlayEvents&&Roblox.GamePlayEvents.SendGamePlayIntent("Party",r.GamePlaceId),f.data("is-game-launch-interface-enabled")==="True"?Roblox.GameLauncher.joinGameWithParty(r.GamePlaceId,r.Id,r.GameId):Roblox.Client.WaitForRoblox(function(){RobloxLaunch.RequestPlayWithParty(u,r.GamePlaceId,r.Id,r.GameId)}))}}}]);

;// ~/viewapp/pages/chat/services/messageService.js
"use strict";chat.factory("messageService",["chatService","chatUtility","$rootScope","$filter","$log",function(n,t,i,r,u){function f(n){n.sent&&!n.parsedTimestamp&&(n.parsedTimestamp=+new Date(n.sent))}function e(n,t,i){var f=angular.isDefined(i)?i:new Date,u=new Date(t),e=u.toDateString(),s=Math.round(Math.abs(f.getTime()-u.getTime())/o),h=u.getDay();n.displayTimeStamp=f.toDateString()===e?r("date")(t,"h:mm a"):s<=h?r("date")(t,"EEE | h:mm a"):r("date")(t,"MMM d, yyyy | h:mm a")}var o=864e5;return{setFallbackClusterMaster:function(n,t){angular.isUndefined(n.chatMessages)&&(n.chatMessages=[]);var r=n.chatMessages.length-1;t.displayTimeStamp&&(t.isClusterMaster=!0),n.chatMessages.length>0&&n.chatMessages[r].senderTargetId!==t.senderTargetId&&(n.chatMessages[r].isClusterMaster=!0),n.chatMessages.push(t)},setClusterMaster:function(n,t){angular.isUndefined(n.chatMessages)&&(n.chatMessages=[]),(n.chatMessages.length>0&&n.chatMessages[0].senderTargetId!==t.senderTargetId||t.displayTimeStamp)&&(t.isClusterMaster=!0),t.resetClusterMessage||n.chatMessages.unshift(t)},buildFallbackTimeStamp:function(n,i,r){var o,u;if(!n.sent)return!1;o=parseInt(t.parytChromeDisplayTimeStampInterval),f(n),u=n.parsedTimestamp,(!i.startTimeStamp||u+o<i.startTimeStamp)&&(e(n,u,r),i.startTimeStamp=u)},buildTimeStamp:function(n,i,r){var o,u;return n.sent?(o=parseInt(t.parytChromeDisplayTimeStampInterval),f(n),u=n.parsedTimestamp,i.previousTimeStamp||(i.startTimeStamp=u),(!i.previousTimeStamp||u-o>i.previousTimeStamp)&&(e(n,u,r),i.previousTimeStamp=u),!0):!1},manipulateMessages:function(r,f,e){var l,h,s,o,c;if(f||(r.messagesDict={},r.unreadMessageIds=[],r.unreadMessageTimestamps=[]),angular.isUndefined(r.messagesDict)&&(r.messagesDict={}),angular.isUndefined(r.unreadMessageIds)&&(r.unreadMessageIds=[],r.unreadMessageTimestamps=[]),f&&f.length>0){for(l=f.length,h=[],r.previousTimeStamp=null,s=l-1;s>=0;s--)o=f[s],this.buildTimeStamp(o,r),r.messagesDict[o.id]||(t.sanitizeMessage(o),r.messagesDict[o.id]=o,this.setClusterMaster(r,o),o.read||(r.unreadMessageIds.push(o.id),r.unreadMessageTimestamps.push(o.parsedTimestamp))),e&&!e[o.senderTargetId]&&h.indexOf(o.senderTargetId)<0&&(u.debug(" ----- new friend information for this message, trying to get now -----"+o.senderTargetId),c={userId:o.senderTargetId},h.push(o.senderTargetId),n.getUserInfo(c).then(function(n){n&&(e[c.userId]=n)},function(){u.debug(" ----- getUserInfo failed -----")}));r.unreadMessageIds.length>0&&i.$broadcast("Roblox.Chat.LoadUnreadConversationCount")}},appendMessages:function(n,r){var o,h,s,e,u,c,l;if(angular.isUndefined(n.unreadMessageIds)&&(n.unreadMessageIds=[],n.unreadMessageTimestamps=[]),t.sanitizeMessages(r),n.chatMessages&&n.chatMessages.length!==0){if(n.chatMessages){for(o={},e=0;e<n.chatMessages.length;e++)if(h=n.chatMessages[e],!h.isSystemMessage&&!h.sendMessageHasError&&!h.resetClusterMessage){o=n.chatMessages[e],f(o);break}for(s=r.length,e=s-1;e>=0;e--)u=r[e],f(u),c=u.id===o.id||o.id&&typeof o.id!="string"&&o.id.toString()===u.id,l=!angular.isUndefined(n.messagesDict)&&!angular.isUndefined(u.id)&&!angular.isUndefined(n.messagesDict[u.id]),(angular.equals({},o)||u.parsedTimestamp>o.parsedTimestamp)&&!c&&!l&&(this.buildTimeStamp(u,n),this.setClusterMaster(n,u)),u.read||(n.hasUnreadMessages=!0,n.unreadMessageIds.push(u.id),n.unreadMessageTimestamps.push(u.parsedTimestamp))}}else{for(s=r.length,e=s-1;e>=0;e--)u=r[e],this.buildTimeStamp(u,n),this.setClusterMaster(n,u);n.chatMessages=r}n.displayMessage=r[0],n.unreadMessageIds.length>0&&i.$broadcast("Roblox.Chat.LoadUnreadConversationCount")},markMessagesAsRead:function(t){var u,f,e,r;t.chatMessages&&t.unreadMessageIds&&(u=t.chatMessages,f=u.length,t.unreadMessageTimestamps.length>0&&t.unreadMessageTimestamps[0]>=u[f-1].parsedTimestamp&&(e=t.unreadMessageIds.length,r=t.unreadMessageIds[e-1],angular.isUndefined(t.pendingUnreadMessageId)&&(t.pendingUnreadMessageId=[]),t.pendingUnreadMessageId.indexOf(r)<0&&(t.pendingUnreadMessageId.push(r),n.markAsRead(t.id,r).then(function(n){n&&(t.hasUnreadMessages=!1,t.unreadMessageIds=[],t.unreadMessageTimestamps=[],t.pendingUnreadMessageId.splice(r,1),i.$broadcast("Roblox.Chat.LoadUnreadConversationCount"))}))))},buildSystemMessage:function(n,i,r){var u=angular.copy(t.systemMessage),e,o;r&&(u.isErrorMsg=!0),e=new Date,u.sent=e.getTime().toString();switch(n){case t.notificationType.iCreatedParty:u.content="<a class='xsmall text-link' href='"+t.party.gamesPageLink+"'>Find Games</a>"+t.party.createPartyText;break;case t.notificationType.iJoinedParty:u.content=t.party.joinPartyText;break;case t.notificationType.partyUserJoined:o=i.newJoinedUsernames.length>0?i.newJoinedUsernames:"Member",u.content=o+t.party.memberJoinText;break;case t.notificationType.conversationTitleModerated:u.content=t.errorMessges.conversationTitleModerated;break;case t.notificationType.conversationTitleChanged:u.content=i.actorUsername+t.party.conversationTitleChangedText+i.title}angular.isUndefined(i.chatMessages)&&(i.chatMessages=[]),f(u),this.setClusterMaster(i,u)},resetConversationUnreadStatus:function(t,r){r.length===0&&t.hasUnreadMessages&&n.markAsRead(t.id,null).then(function(n){n&&(t.hasUnreadMessages=!1,i.$broadcast("Roblox.Chat.LoadUnreadConversationCount"))})}}}]);

;// ~/viewapp/pages/chat/services/cookieService.js
"use strict";chat.factory("cookieService",["$log",function(){return{isCookieDefined:function(n){return angular.isDefined($.cookie(n))&&$.cookie(n)},updateCookie:function(n,t,i){$.cookie(n,JSON.stringify(t),i)},retrieveCookie:function(n){return this.isCookieDefined(n)?JSON.parse($.cookie(n)):[]},destroyCookie:function(n,t){$.cookie(n,null,t)}}}]);

;// ~/viewapp/pages/chat/services/chatUtilityService.js
"use strict";chat.factory("chatUtility",["$filter","$window","chatLayoutText","dialogAttributes","notificationsName","notificationType","userPresenceTypes","deviceTypes","callBackTypes","performanceMarkLabels","resources","$log",function(n,t,i,r,u,f,e,o,s,h,c){function w(n,t,i){return t.maxHeightOfInput=i.tabletInApp?parseInt(t.maxHeightOfTextInput)+parseInt(t.paddingOfInputInTablet):parseInt(t.maxHeightOfTextInput)+parseInt(t.paddingOfInput),t.maxHeightOfInput<n?t.maxHeightOfInput:n}var v,p={dialogType:r.dialogTypes.NEWGROUPCHAT,layoutId:i.groupChat.layoutId,title:i.groupChat.title},y={dialogType:r.dialogTypes.NEWPARTY,layoutId:i.newParty.layoutId,title:i.newParty.title,isCreated:!1,partyName:i.newParty.partyName},a=angular.element("#chat-data-model");return{chatMainElement:angular.element(document.querySelector("#chat-main")),parytChromeDisplayTimeStampInterval:a.data("parytchromedisplaytimestampinterval"),isLocalStorageEnabledForClient:a.data("localstorageenabledforchat"),friendsListOutputCacheDurationInSeconds:a.data("friendslistoutputcachedurationinseconds"),linksLibrary:{settingTabName:"Settings",settingLink:"/my/account#!/privacy"},chatLayout:{scrollbarClassName:"#chat-friend-list",chatContentSelector:"#chat-main",collapsed:!0,pageInitializing:!1,pageDataLoading:!1,chatBarInitialized:!1,isChatLoading:!1,widthOfChatCollapsed:112,widthOfChat:256,widthOfDialog:250,spaceOfDialog:6,widthOfDialogMinimize:200,numberOfDialogOpen:0,defaultChatZIndex:1030,errorMaskEnable:!1,isFriendListEmpty:!1,isUserConversationEmpty:!1,chatLandingEnabled:!1,thresholdMobile:543,thresholdChatBarOpen:1738,resizing:!1,defaultTitleForMessage:" says ...",defaultTitleForPartyInvite:"Party invite from ",heightOfMobileInput:50,heightOfTabletInput:80,urlParseInitialized:!1,noConnectionMsg:"Connecting...",isChatDisabledByPrivacySetting:!1},chatApiParams:{pageNumberOfUnreadConversations:1,pageSizeOfUnreadConversations:30,pageNumberOfPartyInvites:1,pageSizeOfPartyInvites:30,pageNumberOfConversations:1,pageSizeOfConversations:30,pageSizeOfDisplayMessages:1,pageSizeOfUnreadMessages:30,pageSizeOfGetMessages:30,startIndexOfFriendList:0,pageSizeOfFriendList:50,loadMoreUnreadConversations:!1,loadMoreConversations:!0,loadMoreFriends:!0,loadMoreInvitedParties:!1,loadMoreCurrentParty:!1},partyApiParams:{pageNumberOfPartyInvites:1,pageSizeOfPartyInvites:30,loadMoreInvitedParties:!1,loadMoreCurrentParty:!1},dialogParams:{loadMoreMessages:!0,sendingMessage:!1,sendMessageHasError:!1,loadMoreFriends:!1,startIndexOfFriendList:0,pageSizeOfFriendList:50,pageSizeOfGetMessages:30},dialogLayout:{lookUpMembers:!1,focusMeEnabled:!0,hasFocus:!1,active:!1,isChatLoading:!1,collapsed:!1,isConfirmationOn:!1,isMembersOverloaded:!1,scrollToBottom:!1,IsdialogContainerVisible:!1,inviteBtnDisabled:!0,limitMemberDisplay:6,heightOfInput:40,maxHeightOfTextInput:56*1.2,maxHeightOfInput:56*1.2+10,paddingOfInputInTablet:12,paddingOfInput:17,limitCharacterCount:160,heightOfBanner:40,templateUrl:c.templates.dialogTemplate,scrollbarElm:null,listenToScrollInitialized:!1,isBannerEnabled:!1,renameEditor:{isEnabled:!1,hasFocus:!1,maxLengthInput:50},bannerType:r.dialogBannerTypes.default,confirmDialog:{isOpen:!1,title:"",btnName:"",type:""}},dialogBannerTypes:r.dialogBannerTypes,userPresenceTypes:e,dialogType:r.dialogTypes,newGroup:p,scrollBarType:r.scrollBarTypes,newParty:y,party:{partyName:i.party.partyName,partyInviteMsg:i.party.partyInviteMsg,isPartyExisted:!1,isPartyLeader:!1,partyLeaderTooltip:i.party.partyLeaderTooltip,partyMemberTooltip:i.party.partyMemberTooltip,pendingMemberTooltip:i.party.pendingMemberTooltip,memberJoinText:i.party.memberJoinText,joinPartyText:i.party.joinPartyText,createPartyText:i.party.createPartyText,conversationTitleChangedText:i.party.conversationTitleChangedText},errorMessges:i.errorMessges,memberStatus:r.memberStatus,dialogInitValue:{isUpdated:!0,updateStatus:r.dialogStatus.INIT,markAsActive:!1,activeType:null,autoOpen:!1},dialogStatus:r.dialogStatus,conversationInitStatus:{remove:!1},conversationType:r.conversationType,participantType:r.participantType,notificationsName:u,notificationType:f,systemMessage:{isSystemMessage:!0,isErrorMsg:!1},deviceType:o,activeType:r.activeType,performanceMarkLabels:h.chat,resultType:s,hashOutContent:function(n){return n?n.replace(/\S/g,"#"):n},buildScrollbar:function(n){var t=angular.element(document.querySelector(n));t.mCustomScrollbar({autoExpandScrollbar:!1,scrollInertia:1,contentTouchScroll:1,mouseWheel:{preventDefault:!0}})},updateScrollbar:function(n){var t=angular.element(document.querySelector(n));t.mCustomScrollbar("update")},removeParty:function(n,t){var i=t.layoutId,u,f;t.party?(t.dialogType=r.dialogTypes.PENDINGPARTY,u=t.party.Id,t.party.LeaderUser.Id===n.userId&&t.party.MemberUsers.length===1&&t.party.MemberUsers[0].Id===n.userId&&(t.party=null,t.placeThumbnail=null,t.dialogType=t.isGroupChat?r.dialogTypes.GROUPCHAT:r.dialogTypes.CHAT),angular.isDefined(n.partyIds)&&(f=n.partyIds.indexOf(u),f>-1&&n.partyIds.splice(f,1)),angular.isDefined(n.partiesDict)&&delete n.partiesDict[u]):t.dialogType=t.isGroupChat?r.dialogTypes.GROUPCHAT:r.dialogTypes.CHAT,n.dialogDict[i]&&n.dialogIdList.indexOf(i)>-1&&(n.dialogDict[i].isUpdated=!0,n.dialogDict[i].updateStatus=r.dialogStatus.REFRESH)},deleteParty:function(n,t,i){if(n.partyIds.length>0){var r=angular.copy(n.partyIds),u=this;r.forEach(function(r){if(r===i){var f=n.partiesDict[r].layoutId,e=t[f];u.removeParty(n,e)}})}},cleanPartyList:function(n,t,i){if(n.partyIds.length>0){var r=angular.copy(n.partyIds),u=this;r.forEach(function(r){if(r!==i){var f=n.partiesDict[r].layoutId,e=t[f];u.removeParty(n,e)}})}},htmlEntities:function(n){return String(n).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},linkify:function(n){return angular.isDefined(Roblox)&&angular.isDefined(Roblox.Linkify)&&typeof Roblox.Linkify.String=="function"?Roblox.Linkify.String(n):n},sortFriendList:function(t,i){var f=n("orderBy"),r=[],u=[],e=[];return t.friendIds.forEach(function(n){var i=t.friendsDict[n];i.UserPresenceType>0?r.push(i):u.push(i),e.push(n)}),angular.forEach(i,function(n){e.indexOf(n.Id)<0&&(n.UserPresenceType>0?r.push(n):u.push(n)),t.friendIds.indexOf(n.Id)<0&&t.friendIds.push(n.Id)}),r=f(r,"+name"),u=f(u,"+name"),i=r.concat(u)},getScrollBarSelector:function(n,t){var i=n.layoutId;angular.isUndefined(t)&&(t=n.scrollBarType);switch(t){case r.scrollBarTypes.FRIENDSELECTION:return"#scrollbar_friend_"+n.dialogType+"_"+i;case r.scrollBarTypes.MESSAGE:default:return"#scrollbar_"+n.dialogType+"_"+i}},sanitizeMessage:function(n){n&&n.content&&(n.content=this.htmlEntities(n.content),n.content=this.linkify(n.content))},sanitizeMessages:function(n){var t,i;if(n&&n.length>0)for(t=0;t<n.length;t++)i=n[t],this.sanitizeMessage(i)},getDataForMarkingSeen:function(n){var i=[];return t.document.hasFocus&&t.document.hasFocus()&&angular.forEach(n,function(n){n.isConversation&&i.push(n.id)}),i},buildPartyName:function(n){return y.partyName+n},updateConversationTitle:function(n,t){n.title=t,n.name=t,n.dialogType===this.dialogType.PARTY&&(n.partyName=this.buildPartyName(t))},updateDialogStyle:function(n,t,i){if(i.inApp&&t.inAppStyle){var u=i.inAppLayout,r=u.topBarHeight,e=0,f=0,o=0,s=r/2-9;t.inAppStyle.headerStyle={height:r+"px","padding-top":s+"px"},t.isBannerEnabled||t.renameEditor.isEnabled?(f=r+this.dialogLayout.heightOfBanner,t.inAppStyle.bannerStyle={top:r+"px"}):f=r,o=f+u.inputHeight,e="calc("+u.dialogHeight+" - "+o+"px)",t.inAppStyle.dialogStyle={top:f+"px",height:e},t.inAppStyle.friendsListStyle={top:r+u.searchHeight+"px",height:"100%"}}},setInAppLayout:function(n){var t=n.inAppLayout,r=t.topBarHeight/2-9,i;t.headerStyle={height:t.topBarHeight+"px","padding-top":r+"px"},i="calc(100% - "+t.topBarHeight+"px)",t.chatBodyHeight={height:i}},setResizeInputLayout:function(n,t,i,r){var o,e,u=n.inApp?n.inAppLayout:n.layout,f=u.topBarHeight,s=w(t,r,n),h;r.isBannerEnabled?(o=f+u.bannerHeight,e=f+s+u.bannerHeight):r.renameEditor.isEnabled?(o=f+u.renameEditorHeight,e=f+s+u.renameEditorHeight):(o=f,e=f+s),h=n.inApp?"calc("+u.dialogHeight+" - "+e+"px)":u.dialogHeight-e+"px",n.inApp?(r.inAppStyle.dialogStyle={top:o+"px",height:h},r.inAppStyle.inputStyle={height:t}):(r.defaultStyle.dialogStyle={height:h},r.defaultStyle.inputStyle={height:t})},setInApp:function(n){v=n},isInApp:function(){return v}}}]);

;// ~/viewapp/pages/chat/services/chatClientStorageUtilityService.js
"use strict";chat.factory("chatClientStorageUtilityService",["chatUtility","localStorageService","cookieService",function(n,t,i){return{storageDictionary:{dialogIdList:"dialogIdList",dialogDict:"dialogDict",dialogsLayout:"dialogsLayout",chatBarLayout:"chatBarLayout",chatFriendsListReloadTime:"chatFriendsListReloadTime"},isStorageDefined:function(t){return typeof Storage!="undefined"&&n.isLocalStorageEnabledForClient?this.getFromStorage(t):i.isCookieDefined(t)},getFromStorage:function(r){return typeof Storage!="undefined"&&n.isLocalStorageEnabledForClient?t.getLocalStorage(r):i.retrieveCookie(r)},updateStorage:function(r,u,f){typeof Storage!="undefined"&&n.isLocalStorageEnabledForClient?t.setLocalStorage(r,u):i.updateCookie(r,u,f)},removeFromStorage:function(r,u){typeof Storage!="undefined"&&n.isLocalStorageEnabledForClient?t.removeLocalStorage(r):i.destroyCookie(r,u)},updateChatFriendsListReloadTime:function(n){this.updateStorage(this.storageDictionary.chatFriendsListReloadTime,n)}}}]);

;// ~/viewapp/pages/chat/services/chatHybridService.js
"use strict";chat.factory("chatHybridService",["$log",function(){function t(){return Roblox&&Roblox.Hybrid&&Roblox.Hybrid.Chat}return{urlParamNames:{startConversationWithUserid:"startConversationWithUserid",conversationId:"conversationId"},setNewMessageNotification:function(n,i){t()&&(angular.isUndefined(i)&&(i=function(){}),Roblox.Hybrid.Chat.newMessageNotification(n,i))},joinGame:function(n,i){t()&&(angular.isUndefined(i)&&(i=function(){}),Roblox.Hybrid.Game.launchPartyForPlaceId(n,i))},getTopBarHeight:function(n){t()&&Roblox.Hybrid.Chat.getTopBarHeight(n)},openDialog:function(n){t()&&(angular.isUndefined(n)&&(n=function(){}),Roblox.Hybrid.Chat.enterConversation(n))},closeDialog:function(n){t()&&(angular.isUndefined(n)&&(n=function(){}),Roblox.Hybrid.Chat.leaveConversation(n))}}}]);

;// ~/viewapp/pages/chat/directives/chatDataDirective.js
"use strict";chat.directive("chatData",["chatService","partyService","ngAudio","chatUtility","chatHybridService","googleAnalyticsEventsService","$log",function(n,t,i,r,u,f){return{restrict:"A",scope:{chatViewModel:"=",chatLibrary:"="},link:function(e,o,s){var h="https://chat."+s.domain,l="https://notifications."+s.domain,c;e.chatViewModel={chatDomain:h,friendsDict:{},friendsHasConversation:[],chatUserDict:{},signalRDomain:l,signalRHubName:"userNotificationHub",convIdsForInvitedParties:[],invitedParties:{}},e.chatLibrary.domain=s.domain,e.chatLibrary.gamesPageLink=s.gamespagelink,r.party.gamesPageLink=s.gamespagelink,e.chatLibrary.userId=parseInt(s.userid),e.chatLibrary.spinner=s.spinner,e.chatLibrary.deviceType=s.devicetype,e.chatLibrary.inApp=s.inapp==="true",e.chatLibrary.togglechatbarenabled=s.togglechatbarenabled==="true",e.chatLibrary.tabletInApp=s.devicetype===r.deviceType.TABLET&&s.inapp==="true",e.chatLibrary.phoneInApp=s.devicetype===r.deviceType.PHONE&&s.inapp==="true",e.chatLibrary.maxNumberOfPartyMembers=s.numberofmembersforpartychrome,e.chatLibrary.quotaOfPartyMembers=s.numberofmembersforpartychrome-1,e.chatLibrary.intervalOfChangeTitleForPartyChrome=s.intervalofchangetitleforpartychrome,e.chatLibrary.audio=i.load(Roblox.Chat.SoundFile),e.chatLibrary.cookieOption={domain:s.domain,path:"/",expires:null},e.chatLibrary.dialogLocalStorageName="dialogLibrary_"+s.domain,e.chatLibrary.cleanPartyFromConversationEnabled=s.cleanpartyfromconversationenabled==="true",e.chatLibrary.initialConversationToDisplay=s.initialconversationtodisplay,e.chatLibrary.isClientSideUrlParseEnabled=s.isclientsideurlparseenabled==="true",e.chatLibrary.signalRDisconnectionResponseInMilliseconds=s.signalrdisconnectionresponseinmilliseconds,c=e.chatLibrary.inApp?f.eventActions.ChatEmbedded:f.eventActions.Chat,c+=": "+f.getUserAgent(),e.chatLibrary.googleAnalyticsEvent={category:f.eventCategories.JSErrors,action:c},n.setParams(h),n.setAvatarHeadshotsMultigetLimit(s.avatarheadshotsmultigetlimit),n.setUserPresenceMultigetLimit(s.userpresencemultigetlimit),t.setParams(h),r.setInApp(e.chatLibrary.inApp),e.chatLibrary.layout={inputHeight:32,topBarHeight:32,dialogHeight:320,bannerHeight:40,searchHeight:34,renameEditorHeight:32},e.chatLibrary.inApp&&(e.chatLibrary.inAppLayout={},u.getTopBarHeight(function(n,t){e.chatLibrary.inAppLayout={inputHeight:e.chatLibrary.tabletInApp?r.chatLayout.heightOfTabletInput:r.chatLayout.heightOfMobileInput,topBarHeight:parseInt(t.topBarHeight),dialogHeight:"100%",bannerHeight:40,renameEditorHeight:52,searchHeight:42},r.setInAppLayout(e.chatLibrary)})),e.chatLibrary.tabletInApp&&(e.chatLibrary.chatPlaceholderEnabled=!0)}}}]);

;// ~/viewapp/pages/chat/controllers/chatController.js
"use strict";chat.controller("chatController",["$scope","chatService","partyService","messageService","chatUtility","chatClientStorageUtilityService","localStorageService","chatHybridService","performanceService","googleAnalyticsEventsService","hybridService","urlService","$window","$document","$timeout","$log",function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p){var d=function(t){n.chatLibrary.dialogDict[t]&&(n.chatLibrary.dialogDict[t].isUpdated=!0,n.chatLibrary.dialogDict[t].updateStatus=u.dialogStatus.REFRESH)},ft=function(){var t=v.innerWidth(),i=t-u.chatLayout.widthOfChat-u.chatLayout.widthOfDialogMinimize,r=u.chatLayout.widthOfDialog+u.chatLayout.spaceOfDialog;n.chatLibrary.chatLayout.availableNumberOfDialogs=Math.floor(i/r),n.chatLibrary.chatLayout.numberOfDialogs=n.chatLibrary.dialogIdList.length,p.debug(" -------------numberOfDialogs = -------------- "+n.chatLibrary.chatLayout.numberOfDialogs),p.debug(" -------------availableNumberOfDialogs = -------------- "+n.chatLibrary.chatLayout.availableNumberOfDialogs)},st=function(){var t=v.innerWidth();return n.chatLibrary.chatLayout.numberOfDialogs>=n.chatLibrary.chatLayout.availableNumberOfDialogs&&t>u.chatLayout.thresholdMobile},ei=function(){var t=v.innerWidth();return n.chatLibrary.chatLayout.numberOfDialogs<n.chatLibrary.chatLayout.availableNumberOfDialogs&&t>u.chatLayout.thresholdMobile},vt=function(t,i){n.chatLibrary.dialogDict[t]&&(n.chatLibrary.dialogDict[t].markAsActive=!0,n.chatLibrary.dialogDict[t].activeType=i)},g=function(t){n.chatLibrary.dialogDict[t.layoutId]&&d(t.layoutId),n.chatLibrary.deviceType===u.deviceType.COMPUTER&&!n.chatLibrary.dialogDict[t.layoutId]&&(t.dialogType===u.dialogType.PENDINGPARTY||t.displayMessage&&t.displayMessage.content)&&n.launchDialog(t.layoutId,!0)},pt=function(t,i){t&&n.chatLibrary.partyIds.indexOf(t)<0&&(n.chatLibrary.partyIds.push(t),n.chatLibrary.partiesDict[t]={conversationId:i.id,layoutId:i.layoutId}),n.chatLibrary.partyIds.length>0&&(n.chatLibrary.party.isPartyExisted=!0)},dt=function(i){i.length>0&&t.multiGetLatestMessages(i,u.chatApiParams.pageSizeOfDisplayMessages).then(function(t){t&&t.length>0&&angular.forEach(t,function(t){var i=t.chatMessages,e=i.length>0?i[0]:{},f;n.chatLibrary.conversationsDict[t.conversationId]&&(f=n.chatLibrary.conversationsDict[t.conversationId].layoutId,u.sanitizeMessage(e),n.chatUserDict[f].displayMessage=e,r.resetConversationUnreadStatus(n.chatUserDict[f],i))})},function(){p.debug("----- multiGetLatestMessages request is failed ! ------")})},rt=function(){(n.chatLibrary.chatLayout.collapsed||n.chatLibrary.inApp)&&t.getUnreadConversationCount().then(function(t){if(t){var i=t.count;n.chatViewModel.conversationCount=i,n.chatLibrary.inApp&&o.setNewMessageNotification(i)}},function(){p.debug("----- getUnreadConversationCount request is failed ! ------")})},ut=function(i){var r=[];r.push(i),t.getConversations(r).then(function(t){t&&n.buildChatUserListByUnreadConversations(t)})},bt=function(i,f){var o=n.getLayoutId(i,u.dialogType.CHAT),e;angular.isUndefined(n.chatUserDict[o])?ut(i):(e=n.chatUserDict[o],t.getMessages(i,null,u.dialogParams.pageSizeOfGetMessages).then(function(i){if(i&&i.length>0&&(r.appendMessages(e,i),n.updateChatViewModel(e,!0),g(e),!f)){vt(e.layoutId,u.activeType.NEWMESSAGE);var o=u.getDataForMarkingSeen(n.chatUserDict);o.length>0&&t.markAsSeen(o)}}))},wt=function(i,r,f,e){var o,s;i.party=r,i.dialogType=!i.isGroupChat&&f?u.dialogType.CHAT:u.dialogType.PENDINGPARTY,i.incomingPartyInvite=!0,i.pendingPartyMsg=u.party.partyInviteMsg,n.getUserInfoForConversation(i),o=i.layoutId,n.chatLibrary.dialogDict[o]&&d(o),e===r.Id&&(g(i),f||(vt(i.layoutId,u.activeType.PARTYINVITE),s=u.getDataForMarkingSeen(n.chatUserDict),s.length>0&&t.markAsSeen(s))),n.chatLibrary.pendingPartiesDict[r.Id]={conversationId:i.id,layoutId:i.layoutId}},nt=function(r,f){i.getInvitedParties(n.partyApiParams.pageNumberOfPartyInvites,n.partyApiParams.pageSizeOfPartyInvites).then(function(i){var o=n.chatUserDict,e=!1;i&&i.length>0?(i.forEach(function(t){t&&(angular.equals({},o)||angular.forEach(o,function(n){n.isConversation&&t.ConversationId===n.id&&(wt(n,t,f,r),e=!0)}),e||(n.convIdsForInvitedParties.push(t.ConversationId),n.invitedParties[t.ConversationId]=t))}),i.length===n.partyApiParams.pageSizeOfPartyInvites&&(n.partyApiParams.pageNumberOfPartyInvites++,n.partyApiParams.loadMoreInvitedParties=!0,nt(r,f)),e||(t.getConversations(n.convIdsForInvitedParties).then(function(t){if(t){var i=[];t.forEach(function(t){var e=n.invitedParties[t.id],s=n.chatLibrary.userId===e.LeaderUser.Id?u.dialogType.PARTY:u.dialogType.PENDINGPARTY,o=n.getLayoutId(t.id,u.dialogType.PENDINGPARTY);n.chatUserDict[o]?(wt(n.chatUserDict[o],e,f,r),n.updateChatViewModel(n.chatUserDict[o],!0)):(t.party=e,t.dialogType=s,i.push(t))}),i.length>0&&n.buildChatUserListByConversations(i,!0),n.convIdsForInvitedParties=[],n.invitedParties={}}}),n.partyApiParams.loadMoreInvitedParties=!1)):n.partyApiParams.loadMoreInvitedParties=!1})},yt=function(n){n.party=null,n.placeThumbnail=null,n.dialogType=n.isGroupChat?u.dialogType.GROUPCHAT:u.dialogType.CHAT,d(n.layoutId)},ni=function(t){var i=!1,r,f,e;u.deleteParty(n.chatLibrary,n.chatUserDict,t),n.chatLibrary.pendingPartiesDict[t]&&(i=!0,r=n.chatLibrary.pendingPartiesDict[t].layoutId,f=n.chatUserDict[r],yt(f)),n.chatLibrary.cleanPartyFromConversationEnabled&&!i&&(e=n.chatUserDict,angular.forEach(e,function(n){n.isConversation&&n.party&&n.party.Id===t&&(i=!0,yt(n))}))},gt=function(n,t){var i,r;if(angular.isDefined(n.party))for(n.newJoinedUsernames="",i=0;i<t.MemberUsers.length;i++)if(r=t.MemberUsers[i],!n.membersDict[r.Id]||n.membersDict[r.Id].memberStatus===u.memberStatus.PENDING){n.newJoinedUsernames=r.Name;break}n.party=t},tt=function(f){i.getCurrentParty().then(function(e){var s;if(e){u.cleanPartyList(n.chatLibrary,n.chatUserDict,e.Id);var c=e.ConversationId,h=n.getLayoutId(c,u.dialogType.PARTY),o=n.chatUserDict[h];n.chatLibrary.partiesDict[e.Id]||pt(e.Id,o),o.dialogType=u.dialogType.PARTY,gt(o,e),o.party.LeaderUser.Id===n.chatLibrary.userId&&(n.chatLibrary.party.isPartyLeader=!0),o.party.GamePlaceId&&o.party.LeaderUser.Id!==n.chatLibrary.userId&&i.joinGame(o,n.chatLibrary.inApp),o.party.GamePlaceId&&!o.placeThumbnail&&i.getPlace(o.party.GamePlaceId).then(function(n){o.placeThumbnail=n}),d(h),n.getUserInfoForConversation(o),n.updateChatViewModel(o,!0),angular.isDefined(f)&&r.buildSystemMessage(f,o),s=u.getDataForMarkingSeen(n.chatUserDict),s.length>0&&t.markAsSeen(s)}else u.cleanPartyList(n.chatLibrary,n.chatUserDict,null)},function(){p.debug(" -------- getCurrentParty request failed ------ ")})},fi=function(){angular.isDefined(n.preSetChatLibrary)&&angular.isDefined(n.preSetChatLibrary.dialogIdList)&&(n.chatLibrary.dialogIdList=n.preSetChatLibrary.dialogIdList,angular.forEach(n.preSetChatLibrary.dialogDict,function(t,i){t.isUpdated||(t.isUpdated=!0),i===u.newGroup.layoutId&&(n.chatUserDict[u.newGroup.layoutId]=n.newGroup),n.chatLibrary.dialogDict[i]=t,n.preSetChatLibrary.dialogsLayout[i]&&(n.chatLibrary.dialogsLayout[i]=n.preSetChatLibrary.dialogsLayout[i])}))},lt=function(){return a.innerWidth>=u.chatLayout.thresholdChatBarOpen&&!n.chatLibrary.isTakeOverOn&&!angular.element(document.querySelector("#GamesPageLeftColumn")).length},kt=function(){if(!n.chatLibrary.inApp){var t={collapsed:n.chatLibrary.chatLayout.collapsed};f.updateStorage(f.storageDictionary.chatBarLayout,t,n.chatLibrary.cookieOption)}},w,ct=function(){n.chatUserDict={},n.dialogType=angular.copy(u.dialogType),n.deviceType=angular.copy(u.deviceType),n.memberStatus=angular.copy(u.memberStatus),n.userPresenceTypes=angular.copy(u.userPresenceTypes),n.newGroup=angular.copy(u.newGroup),n.newParty=angular.copy(u.newParty),n.party=angular.copy(u.party),n.selectedFriendIds=[],n.chatLibrary={partyIds:[],partiesDict:{},pendingPartiesDict:{},conversationsDict:{},userConversationsDict:{},friendIds:[],friendLayoutIds:[],friendsDict:{},chatLayout:angular.copy(u.chatLayout),chatLayoutIds:[],layoutIdList:[],dialogIdList:[],dialogDict:{},dialogsLayout:{},party:u.party,minimizedDialogIdList:[],minimizedDialogData:{},isTakeOverOn:angular.element(document.querySelector("#wrap")).data("gutter-ads-enabled"),currentTabTitle:a.document.title,dialogScopeLib:{},dialogInAppOpen:!1,screenHeight:screen?screen.height:0,dialogRequestedToOpenParams:{layoutId:null,autoPop:!1}},n.convIdsForInvitedParties=[],n.invitedParties={},angular.isDefined(Roblox.RealTime)&&(w=Roblox.RealTime.Factory.GetClient())},ht=function(){n.preSetChatLibrary={},n.chatLibrary.phoneInApp||(n.preSetChatLibrary=f.isStorageDefined(f.storageDictionary.dialogIdList)&&f.isStorageDefined(f.storageDictionary.dialogDict)?{dialogIdList:f.getFromStorage(f.storageDictionary.dialogIdList),dialogDict:f.getFromStorage(f.storageDictionary.dialogDict),dialogsLayout:f.isStorageDefined(f.storageDictionary.dialogsLayout)?f.getFromStorage(f.storageDictionary.dialogsLayout):{}}:{dialogIdList:[],dialogDict:{},dialogsLayout:{}},f.isStorageDefined(f.storageDictionary.chatBarLayout)&&(n.preSetChatLibrary.chatBarLayout=f.getFromStorage(f.storageDictionary.chatBarLayout))),n.chatApiParams=angular.copy(u.chatApiParams),n.partyApiParams=angular.copy(u.partyApiParams)},it,at;n.setDataInChatLibrary=function(t){n.chatLibrary.isRenameConversationTitleInChatEnabled=t.IsRenameConversationTitleInChatEnabled,n.chatLibrary.isAddFriendsTo1To1ConversationEnabled=t.IsAddFriendsTo1To1ConversationEnabled,n.chatLibrary.chatLayout.isChatDisabledByPrivacySetting=t.IsChatDisabledByPrivacySetting,n.chatLibrary.isChatEmbeddedDebugInDesktopEnabled=t.IsChatEmbeddedDebugInDesktopEnabled,n.chatLibrary.chatLayout.isAgeBracketLabelEnabled=t.IsAgeBracketLabelEnabled,n.chatLibrary.isUserUnder13=t.IsUserUnder13,n.chatLibrary.username=t.Username,n.chatLibrary.isHybridCallForGroupChatAvatarEnabled=t.IsHybridCallForGroupChatAvatarEnabled};var ti=function(){t.setup().then(function(i){i&&(n.setDataInChatLibrary(i),t.setChatData(i),n.initializeRealTimeSubscriptionsForChatPrivacySetting(),n.chatLibrary.chatLayout.isChatDisabledByPrivacySetting||(n.chatLibrary.chatLayout.pageDataLoading=!0,it(),n.initializeRealTimeSubscriptionsForChat()),n.chatLibrary.chatLayout.pageInitializing&&(n.chatLibrary.chatLayout.pageInitializing=!1))})},ii=function(){n.chatLibrary.inApp?(n.chatLibrary.chatLayout.collapsed=!1,n.chatLibrary.chatLayout.chatBarInitialized=!0):n.chatLibrary.inApp||n.chatLibrary.chatLayout.chatBarInitialized||(lt()&&!n.preSetChatLibrary.chatBarLayout?n.chatLibrary.chatLayout.collapsed=!1:n.preSetChatLibrary.chatBarLayout?n.chatLibrary.chatLayout.collapsed=n.preSetChatLibrary.chatBarLayout.collapsed:lt()||(n.chatLibrary.chatLayout.collapsed=!0),n.chatLibrary.chatLayout.chatBarInitialized=!0),s.logSinglePerformanceMark(u.performanceMarkLabels.chatPageDataLoaded)},ri=function(t){if(n.chatLibrary.friendIds.indexOf(t.Id)<0&&n.chatLibrary.friendIds.push(t.Id),n.chatLibrary.friendsDict[t.Id]||(n.chatLibrary.friendsDict[t.Id]=angular.copy(t)),n.chatViewModel.friendsHasConversation.indexOf(t.Id)<0){var i=n.getLayoutId(t.Id,u.dialogType.FRIEND);t.layoutId=i,t.isConversation=!1,t.dialogType=u.dialogType.FRIEND,n.chatLibrary.friendLayoutIds.indexOf(i)<0&&n.chatLibrary.friendLayoutIds.push(i),n.updateChatViewModel(t,!1),n.chatLibrary.chatLayout.chatLandingEnabled&&(n.chatLibrary.chatLayout.chatLandingEnabled=!1)}},k=function(t,i){var r=n.chatLibrary.layoutIdList.indexOf(t);i&&r>-1?n.chatLibrary.layoutIdList.splice(r,1):!i&&r<0&&n.chatLibrary.layoutIdList.push(t)},ot=function(t){return n.chatLibrary.userConversationsDict[t]?n.chatLibrary.userConversationsDict[t]:null},ui=function(t){var i=ot(t),r,e,f,o;i||(i=n.getLayoutId(t,u.dialogType.FRIEND)),r=n.chatUserDict[i],r&&r.isConversation?(e=n.chatUserDict[i].id,n.chatLibrary.conversationsDict[e].remove=!0):r&&(f=n.chatLibrary.chatLayoutIds.indexOf(i),f>-1&&(n.chatLibrary.chatLayoutIds.splice(f,1),delete n.chatUserDict[i],k(i,!0))),n.chatViewModel.friendsHasConversation.indexOf(t)>-1&&(o=n.chatViewModel.friendsHasConversation.indexOf(t),n.chatViewModel.friendsHasConversation.splice(o,1)),n.chatLibrary.chatLayoutIds.indexOf(i)>-1&&n.closeDialog(i),n.chatLibrary.chatLayoutIds.length===0&&(n.chatLibrary.chatLayout.chatLandingEnabled=!0)},et=function(){if(window&&window.location){p.debug("--- -initialzeUrlParser- ---");var t=window.location.search;t&&t.indexOf("?")>-1&&(t=t.substr(1),t.split("&").forEach(function(t){var i=t.split("="),u=i[0],r=decodeURIComponent(i[1]);switch(u){case o.urlParamNames.startConversationWithUserid:n.startSpecificConversationFromUserId(r);break;case o.urlParamNames.conversationId:n.chatLibrary.chatLayout.urlParseInitialized=!0,n.startSpecificConversationFromConvId(r)}}))}},b=function(t,i){n.buildChatUserListByFriends(n.chatApiParams.startIndexOfFriendList,n.chatApiParams.pageSizeOfFriendList,t).then(function(t){n.chatApiParams.startIndexOfFriendList!==0||t&&t.length!==0||(n.chatLibrary.chatLayout.chatLandingEnabled=!0),n.chatLibrary.chatLayout.pageDataLoading&&(n.chatLibrary.chatLayout.pageDataLoading=!1),t&&t.length>0&&n.filterFriends(t),t&&t.length===n.chatApiParams.pageSizeOfFriendList?(n.chatApiParams.startIndexOfFriendList=+n.chatApiParams.startIndexOfFriendList+n.chatApiParams.pageSizeOfFriendList,b()):(n.chatApiParams.startIndexOfFriendList=0,n.chatApiParams.loadMoreFriends=!1,i&&n.startSpecificConversationFromUserId(i.userId)),n.chatLibrary.isClientSideUrlParseEnabled&&(n.chatLibrary.chatLayout.urlParseInitialized||et())})};n.updateDialogList=function(t,i){var r,f,e;if(n.chatLibrary.inApp&&(n.chatLibrary.dialogIdList.forEach(function(t){n.closeDialog(t)}),n.chatLibrary.dialogIdList=[]),ft(),st()&&n.chatLibrary.deviceType===u.deviceType.COMPUTER)while(n.chatLibrary.dialogIdList.length>=n.chatLibrary.chatLayout.availableNumberOfDialogs){if(r=n.chatLibrary.dialogIdList.pop(),angular.isUndefined(r))break;n.chatLibrary.dialogDict[r].isUpdated=!0,n.chatLibrary.dialogDict[r].updateStatus=u.dialogStatus.MINIMIZE,f=n.chatLibrary.minimizedDialogIdList.indexOf(t),f>-1&&(n.chatLibrary.minimizedDialogIdList.splice(f,1),delete n.chatLibrary.minimizedDialogData[t])}n.chatLibrary.dialogIdList.indexOf(t)<0&&n.chatLibrary.dialogIdList.push(t),e=angular.copy(u.dialogInitValue),angular.isDefined(i)&&i&&(e.autoOpen=!0),n.chatLibrary.dialogDict[t]=e},n.getUserConversations=function(){t.getUserConversations(n.chatApiParams.pageNumberOfConversations,n.chatApiParams.pageSizeOfConversations).then(function(t){s.logSinglePerformanceMark(u.performanceMarkLabels.chatConversationsLoaded),t&&t.length>0&&(n.refreshFriendsDict(),n.buildChatUserListByConversations(t,!1),n.chatApiParams.pageNumberOfConversations++,n.chatApiParams.pageNumberOfPartyInvites++,fi()),!t||t.length<n.chatApiParams.pageSizeOfConversations?(n.chatApiParams.loadMoreConversations=!1,n.chatApiParams.pageNumberOfConversations=1,b(),t&&t.length===0&&(n.chatLibrary.chatLayout.chatLandingEnabled=!0)):(n.chatLibrary.chatLayout.pageDataLoading&&(n.chatLibrary.chatLayout.pageDataLoading=!1),n.chatApiParams.loadMoreConversations=!0),n.chatLibrary.chatLayout.urlParseInitialized||et()},function(){p.debug("--getConversations-error---")})},it=function(){n.chatUserDict&&n.chatLibrary||ct(),s.logSinglePerformanceMark(u.performanceMarkLabels.chatConversationsLoading),rt(),n.getUserConversations()},n.updateConversationTitle=function(i,f){var e=[i];t.getConversations(e).then(function(t){t&&angular.forEach(t,function(t){var o,e;t.id===i&&(o=n.chatLibrary.conversationsDict[i]?n.chatLibrary.conversationsDict[i].layoutId:n.getLayoutId(i,u.dialogType.CHAT),e=n.chatUserDict[o],u.updateConversationTitle(e,t.title),n.chatLibrary.userId!==f&&(e.actorUsername=n.chatLibrary.friendsDict[f].name,r.buildSystemMessage(u.notificationType.conversationTitleChanged,e)))})},function(){p.debug(" -------- getConversations request failed ------ ")})},n.handleChatNotifications=function(t){var r,i;p.debug("--------- this is ChatNotifications subscription -----------"+t.Type);try{switch(t.Type){case u.notificationType.newMessage:bt(t.ConversationId);break;case u.notificationType.newMessageBySelf:bt(t.ConversationId,!0);break;case u.notificationType.newConversation:case u.notificationType.addedToConversation:case u.notificationType.participantAdded:case u.notificationType.participantLeft:ut(t.ConversationId);break;case u.notificationType.removedFromConversation:n.chatLibrary.conversationsDict[t.ConversationId].remove||(r=n.chatLibrary.conversationsDict[t.ConversationId].layoutId,n.chatLibrary.conversationsDict[t.ConversationId].remove=!0,n.closeDialog(r));break;case u.notificationType.conversationTitleChanged:n.updateConversationTitle(t.ConversationId,t.ActorTargetId)}}catch(f){i="ChatNotifications:"+t.Type+": ",f&&f.message&&(i+=f.message),h.fireEvent(n.chatLibrary.googleAnalyticsEvent.category,n.chatLibrary.googleAnalyticsEvent.action,i)}},n.handlePartyNotifications=function(t){p.debug("--------- this is PartyNotifications subscription -----------"+t.Type);try{switch(t.Type){case u.notificationType.invitedToParty:n.partyApiParams.loadMoreInvitedParties||nt(t.PartyId);break;case u.notificationType.iLeftParty:n.partyApiParams.loadMoreInvitedParties||nt(t.PartyId,!0);break;case u.notificationType.partyUserLeft:case u.notificationType.partyLeftGame:n.partyApiParams.loadMoreCurrentParty||tt();break;case u.notificationType.partyJoinedGame:n.partyApiParams.loadMoreCurrentParty||tt();break;case u.notificationType.partyDeleted:ni(t.PartyId);break;case u.notificationType.partyUserJoined:n.partyApiParams.loadMoreInvitedParties||nt(t.PartyId);case u.notificationType.iCreatedParty:case u.notificationType.iJoinedParty:n.partyApiParams.loadMoreCurrentParty||tt(t.Type)}}catch(r){var i="PartyNotifications:"+t.Type+": ";r&&r.message&&(i+=r.message),h.fireEvent(n.chatLibrary.googleAnalyticsEvent.category,n.chatLibrary.googleAnalyticsEvent.action,i)}},n.handleFriendshipNotifications=function(t){var i,e,r;p.debug("--------- this is FriendshipNotifications subscription -----------"+t.Type);try{i=+new Date;switch(t.Type){case u.notificationType.friendshipDestroyed:e=t.EventArgs,angular.forEach(e,function(t){t!==n.chatLibrary.userId&&n.$digest(ui(t))}),f.updateChatFriendsListReloadTime(i),v.triggerHandler("Roblox.Friends.CountChanged");break;case u.notificationType.friendshipCreated:b(i),f.updateChatFriendsListReloadTime(i),v.triggerHandler("Roblox.Friends.CountChanged")}}catch(o){r="FriendshipNotifications:"+t.Type+": ",o&&o.message&&(r+=o.message),h.fireEvent(n.chatLibrary.googleAnalyticsEvent.category,n.chatLibrary.googleAnalyticsEvent.action,r)}},n.handlePresenceNotifications=function(i){var r,f;p.debug("--------- this is PresenceNotifications subscription -----------"+i.Type);try{switch(i.Type){case u.notificationType.presenceOnline:case u.notificationType.presenceOffline:n.chatLibrary.friendsDict[i.UserId]&&(r=n.chatLibrary.friendsDict[i.UserId],t.getUserPresence(r).then(function(t){n.chatLibrary.friendsDict[r.Id].UserPresenceType=t.UserPresenceType},function(){p.debug(" ----- getUserPresence failed -----")}))}}catch(e){f="PresenceNotifications:"+i.Type+": ",e&&e.message&&(f+=e.message),h.fireEvent(n.chatLibrary.googleAnalyticsEvent.category,n.chatLibrary.googleAnalyticsEvent.action,f)}},n.unsubscribeRealTimeForChat=function(){w.Unsubscribe(u.notificationsName.ChatNotifications,n.handleChatNotifications),w.Unsubscribe(u.notificationsName.PartyNotifications,n.handlePartyNotifications),w.Unsubscribe(u.notificationsName.FriendshipNotifications,n.handleFriendshipNotifications),w.Unsubscribe(u.notificationsName.PresenceNotifications,n.handlePresenceNotifications)},n.handleChatPrivacySetting=function(t){p.debug("--------- this is ChatPrivacySettingNotifications subscription -----------"+t.Type);try{switch(t.Type){case u.notificationType.chatEnabled:n.chatLibrary.chatLayout.isChatDisabledByPrivacySetting=!1,n.handleSignalRSuccess(!0),n.initializeRealTimeSubscriptionsForChat();break;case u.notificationType.chatDisabled:n.chatLibrary.chatLayout.isChatDisabledByPrivacySetting=!0,n.unsubscribeRealTimeForChat()}}catch(r){var i="ChatPrivacySettingNotifications:"+t.Type+": ";r&&r.message&&(i+=r.message),h.fireEvent(n.chatLibrary.googleAnalyticsEvent.category,n.chatLibrary.googleAnalyticsEvent.action,i)}},n.initializeRealTimeSubscriptionsForChatPrivacySetting=function(){angular.isDefined(w)&&w.Subscribe(u.notificationsName.ChatPrivacySettingNotifications,n.handleChatPrivacySetting)},n.initializeRealTimeSubscriptionsForChat=function(){angular.isDefined(w)&&(s.logSinglePerformanceMark(u.performanceMarkLabels.chatSignalRInitializing),w.SubscribeToConnectionEvents(n.handleSignalRSuccess,n.handleSignalRSuccess,n.handleSignalRError),w.Subscribe(u.notificationsName.ChatNotifications,n.handleChatNotifications),n.chatLibrary.inApp||w.Subscribe(u.notificationsName.PartyNotifications,n.handlePartyNotifications),w.Subscribe(u.notificationsName.FriendshipNotifications,n.handleFriendshipNotifications),w.Subscribe(u.notificationsName.PresenceNotifications,n.handlePresenceNotifications))},n.handleSignalRSuccess=function(t){if(p.debug(" -------- Signal R is connected ------ "),n.chatLibrary.chatLayout.errorMaskEnable=!1,n.chatLibrary.timer&&y.cancel(n.chatLibrary.timer),n.chatLibrary.chatLayout.pageInitializing){s.logSinglePerformanceMark(u.performanceMarkLabels.chatSignalRSucceeded),n.chatLibrary.chatLayout.pageInitializing=!1;return}try{t&&(ht(),it())}catch(r){var i="handleSignalRSuccess: ";r&&r.message&&(i+=r.message),h.fireEvent(n.chatLibrary.googleAnalyticsEvent.category,n.chatLibrary.googleAnalyticsEvent.action,i)}},n.handleSignalRError=function(){p.debug(" -------- Signal R is disconnected ------ "),n.chatLibrary.timer=y(function(){n.chatLibrary.chatLayout.errorMaskEnable=!0},parseInt(n.chatLibrary.signalRDisconnectionResponseInMilliseconds))},n.isPartyLeader=function(){return n.chatLibrary.party.isPartyLeader},n.onResize=function(){var t;if(n.chatLibrary.chatLayout.numberOfDialogs>n.chatLibrary.chatLayout.availableNumberOfDialogs)while(n.chatLibrary.dialogIdList.length>n.chatLibrary.chatLayout.availableNumberOfDialogs){if(p.debug(" -------------overflow ------ $scope.chatLibrary.dialogIdList.length ------------- "+n.chatLibrary.dialogIdList.length),t=n.chatLibrary.dialogIdList.pop(),angular.isUndefined(t))break;t&&n.chatLibrary.dialogDict[t]&&(n.chatLibrary.dialogDict[t].isUpdated=!0,n.chatLibrary.dialogDict[t].updateStatus=u.dialogStatus.MINIMIZE)}else if(n.chatLibrary.chatLayout.numberOfDialogs<n.chatLibrary.chatLayout.availableNumberOfDialogs)while(n.chatLibrary.dialogIdList.length<n.chatLibrary.chatLayout.availableNumberOfDialogs){if(p.debug(" -------------fit ------ $scope.chatLibrary.dialogIdList.length ------------- "+n.chatLibrary.dialogIdList.length),t=n.chatLibrary.minimizedDialogIdList.pop(),angular.isUndefined(t))break;t&&n.chatLibrary.minimizedDialogData[t]&&(delete n.chatLibrary.minimizedDialogData[t],n.chatLibrary.dialogIdList.push(t),n.chatLibrary.dialogDict[t]=angular.copy(u.dialogInitValue))}n.chatLibrary.chatLayout.resizing=!1},n.toggleChatContainer=function(){n.chatLibrary.togglechatbarenabled&&(n.chatLibrary.chatLayout.collapsed=!n.chatLibrary.chatLayout.collapsed,rt(),n.chatLibrary.chatLayout.chatBarInitialized=!0,kt())},n.getLayoutId=function(n,t){switch(t){case u.dialogType.FRIEND:return"friend_"+n;case u.dialogType.CHAT:case u.dialogType.GROUPCHAT:case u.dialogType.PENDINGPARTY:case u.dialogType.ADDFRIENDS:case u.dialogType.PARTY:return"conv_"+n;case u.dialogType.NEWPARTY:return u.newParty.dialogType;case u.dialogType.NEWGROUPCHAT:return u.newGroup.dialogType}},n.formatUserDataByType=function(n){switch(n.type){case u.participantType.user:n.userId=n.targetId}},n.getUserInfoForConversation=function(i){if(i.initiator&&n.formatUserDataByType(i.initiator),i.participants){if(i.userIds=[],i.dialogType===n.dialogType.PARTY||i.dialogType===n.dialogType.PENDINGPARTY){var r=i.party;i.membersDict={},angular.forEach(r.MemberUsers,function(n){i.membersDict[n.Id]||(i.membersDict[n.Id]=n.Id!==r.LeaderUser.Id?{memberStatus:u.memberStatus.MEMBER,statusTooltip:u.party.partyMemberTooltip}:{memberStatus:u.memberStatus.LEADER,statusTooltip:u.party.partyLeaderTooltip})})}i.participants.forEach(function(r){n.formatUserDataByType(r);var f=r.userId,e=r.name;switch(i.dialogType){case n.dialogType.PENDINGPARTY:case n.dialogType.PARTY:i.membersDict[f]?i.membersDict[f].memberStatus===u.memberStatus.LEADER||i.userIds.length===0?i.userIds.unshift(f):i.membersDict[f].memberStatus===u.memberStatus.MEMBER?i.userIds.splice(1,0,f):i.userIds.push(f):(i.userIds.push(f),i.membersDict[f]={memberStatus:u.memberStatus.PENDING,statusTooltip:n.chatLibrary.party.pendingMemberTooltip}),i.isGroupChat||f===n.chatLibrary.userId?i.isGroupChat&&(i.partyName=u.buildPartyName(i.title)):i.partyName=u.buildPartyName(e);break;case n.dialogType.GROUPCHAT:i.userIds.push(f);break;case n.dialogType.CHAT:f!==n.chatLibrary.userId&&(i.userIds.push(f),i.displayUserId=f,i.username=e);break;default:i.userIds.push(f)}n.chatLibrary.friendsDict[f]||t.getUserInfo(r).then(function(t){t&&f===t.userId&&(n.chatLibrary.friendsDict[f]=t)},function(){p.debug(" ----- getUserInfo failed -----")}),!i.isGroupChat&&n.chatViewModel.friendsHasConversation.indexOf(f)<0&&n.chatViewModel.friendsHasConversation.push(f)})}},n.updateChatViewModel=function(t,i){var r,f,e;t.isGroupChat||t.dialogType!==u.dialogType.CHAT||t.participants.forEach(function(i){var f=i.targetId,r,e;f!==n.chatLibrary.userId&&(r=n.getLayoutId(f,u.dialogType.FRIEND),e=n.chatLibrary.chatLayoutIds.indexOf(r),e>-1&&(n.chatLibrary.chatLayoutIds.splice(e,1),delete n.chatUserDict[r]),k(r,!0),n.chatLibrary.userConversationsDict[f]=t.layoutId)});switch(t.dialogType){case n.dialogType.PENDINGPARTY:t.pendingPartyMsg=u.party.partyInviteMsg,t.incomingPartyInvite=!1,t.name=t.title;break;case n.dialogType.PARTY:pt(t.party.Id,t),t.incomingPartyInvite=!1,t.name=t.partyName;break;case n.dialogType.GROUPCHAT:t.name=t.title;break;case n.dialogType.CHAT:t.name=t.title;break;default:angular.isDefined(t.Username)&&(t.name=t.Username)}n.chatUserDict[t.layoutId]=t,r=n.chatLibrary.chatLayoutIds.indexOf(t.layoutId),r>-1&&n.chatLibrary.chatLayoutIds.splice(r,1),t.isConversation&&(i?n.chatLibrary.chatLayoutIds.length>0&&t.dialogType!==u.dialogType.PARTY?(f=n.chatLibrary.chatLayoutIds[0],e=n.chatUserDict[f],e.dialogType===u.dialogType.PARTY?n.chatLibrary.chatLayoutIds.splice(1,0,t.layoutId):n.chatLibrary.chatLayoutIds.unshift(t.layoutId)):n.chatLibrary.chatLayoutIds.unshift(t.layoutId):t.dialogType&&t.dialogType===u.dialogType.PARTY?n.chatLibrary.chatLayoutIds.unshift(t.layoutId):n.chatLibrary.chatLayoutIds.push(t.layoutId)),k(t.layoutId),t.isConversation&&!n.chatLibrary.conversationsDict[t.id]&&(n.chatLibrary.conversationsDict[t.id]=angular.copy(u.conversationInitStatus),n.chatLibrary.conversationsDict[t.id].layoutId=t.layoutId)},n.refreshFriendsDict=function(){var i=t.getFriendsDict();angular.forEach(i,function(t){n.chatLibrary.friendsDict[t.Id]=t})},n.filterFriends=function(t){var i=[],r;t=u.sortFriendList(n.chatLibrary,t),n.chatLibrary.friendIds=[],n.chatLibrary.friendLayoutIds=[],t.forEach(function(n){ri(n)}),n.chatLibrary.chatLayoutIds.forEach(function(t){n.chatUserDict[t].isConversation&&i.push(t)}),r=i.concat(n.chatLibrary.friendLayoutIds),n.chatLibrary.chatLayoutIds=r},n.buildChatUserListByFriends=function(i,r,u){return n.chatApiParams.loadMoreConversations=!1,n.chatApiParams.loadMoreFriends=!0,t.getFriends(n.chatLibrary.userId,i,r,u)},n.buildChatUserListByUnreadConversations=function(t){t.forEach(function(t){var e,f;t.isGroupChat=u.conversationType.multiUserConversation===t.conversationType,e=n.getLayoutId(t.id,u.dialogType.CHAT),n.chatUserDict[e]?(f=n.chatUserDict[e],t.hasUnreadMessages&&t.chatMessages&&t.chatMessages.length>0&&(f.hasUnreadMessages=!0,n.chatLibrary.dialogDict[e]&&n.chatLibrary.dialogIdList.indexOf(e)>-1&&r.manipulateMessages(f,t.chatMessages,n.chatLibrary.friendsDict),u.sanitizeMessage(t.chatMessages[0]),f.displayMessage=t.chatMessages[0],n.updateChatViewModel(f,!0)),f.participants=t.participants,f.dialogType===u.dialogType.PARTY?i.getCurrentParty().then(function(t){t&&(f.party=t,n.getUserInfoForConversation(f))}):n.getUserInfoForConversation(f),g(f)):(t.layoutId=e,t.isConversation=!0,t.dialogType=t.isGroupChat?u.dialogType.GROUPCHAT:u.dialogType.CHAT,n.getUserInfoForConversation(t),n.updateChatViewModel(t,!0),g(t))})},n.buildChatUserListByConversations=function(t,i){var r=[];t.forEach(function(t){var f=n.getLayoutId(t.id,t.dialogType);r.push(t.id),t.layoutId=f,t.isConversation=!0,n.getUserInfoForConversation(t),n.updateChatViewModel(t,i),t.dialogType===u.dialogType.PARTY&&t.party.LeaderUser.Id===n.chatLibrary.userId&&(n.chatLibrary.party.isPartyLeader=!0)}),dt(r)},n.cancelSearch=function(){n.chatViewModel.searchTerm="",n.chatLibrary.chatLayout.searchFocus=!1},n.openConversation=function(){var i=n.chatLibrary.dialogRequestedToOpenParams.layoutId,r=n.chatLibrary.dialogRequestedToOpenParams.autoPop;n.chatUserDict[i].isConversation?n.updateDialogList(i,r):t.startOneToOneConversation(n.chatUserDict[i].userId).then(function(t){var o=n.chatLibrary.chatLayoutIds.indexOf(i),f,e;n.chatLibrary.chatLayoutIds.splice(o,1),delete n.chatUserDict[i],k(i,!0),f=t.conversation,e=n.getLayoutId(f.id,u.dialogType.CHAT),f.layoutId=e,f.isConversation=!0,f.dialogType=u.dialogType.CHAT,f.chatMessages=[],f.isGroupChat=f.conversationType===u.conversationType.multiUserConversation,n.getUserInfoForConversation(f),n.updateChatViewModel(f,!0),n.updateDialogList(e,r)},function(){p.debug(" ---- startOneToOneConversation ---- failed!")})},n.launchDialog=function(t,i){var r,f;if(n.chatLibrary.dialogRequestedToOpenParams.layoutId=t,n.chatLibrary.dialogRequestedToOpenParams.autoPop=i,n.chatLibrary.tabletInApp&&n.chatLibrary.dialogIdList.length>0)for(r=0;r<n.chatLibrary.dialogIdList.length;r++)n.closeDialog(n.chatLibrary.dialogIdList[r]);n.chatLibrary.dialogIdList.indexOf(t)<0&&t===u.newGroup.layoutId?(n.updateDialogList(t,i),n.chatUserDict[u.newGroup.layoutId]=n.newGroup):n.chatLibrary.dialogIdList.indexOf(t)<0&&n.chatUserDict[t]?n.chatLibrary.inApp&&!n.chatLibrary.tabletInApp?n.chatLibrary.isChatEmbeddedDebugInDesktopEnabled?n.openConversation():(n.$watch(function(){return angular.element(n.chatLibrary.chatLayout.chatContentSelector).innerHeight()},function(t,i){n.chatLibrary.dialogInAppOpen||t===i||t!==n.chatLibrary.screenHeight||(n.chatLibrary.dialogInAppOpen=!0,n.openConversation())},!0),o.openDialog()):n.openConversation():n.chatLibrary.dialogIdList.indexOf(t)>-1&&n.chatLibrary.dialogsLayout[t]&&(f=n.chatLibrary.dialogsLayout[t],f.collapsed&&(f.collapsed=!1,f.focusMeEnabled=!0))},n.destroyDialogLayout=function(n){angular.element(document.querySelector("#"+n)).empty()},n.deleteLayoutIdFromDialogList=function(t){for(var f=n.chatLibrary.dialogIdList,r=[],u,i=0;i<f.length;i++)f[i]===t&&r.push(i);if(r.length>0){for(u=r.length-1;u>=0;u--)n.chatLibrary.dialogIdList.splice(r[u],1);delete n.chatLibrary.dialogDict[t]}},n.closeDialog=function(t){var i=n.chatUserDict[t],l,s,a,h,c,e;i&&(l=u.getScrollBarSelector(i),s=angular.element(document.querySelector(l))),a=angular.element(document.querySelector("#chat-main")),n.deleteLayoutIdFromDialogList(t),i&&i.dialogType===u.dialogType.NEWPARTY&&(n.chatLibrary.party.isPartyExisted=!1),i&&i.dialogType===u.dialogType.NEWGROUPCHAT&&(i.selectedUserIds=[],i.selectedUsersDict={},i.numberOfSelected=0),s&&s.length>0&&s.mCustomScrollbar("destroy"),n.$broadcast("Roblox.Chat.MarkDialogInactive",{layoutId:t}),i&&(h=i.id,n.chatLibrary.conversationsDict[h]&&n.chatLibrary.conversationsDict[h].remove?(c=n.chatLibrary.chatLayoutIds.indexOf(t),c>-1&&i&&(n.chatLibrary.chatLayoutIds.splice(c,1),delete n.chatUserDict[t],angular.equals(n.chatUserDict,{})&&(n.chatLibrary.chatLayout.chatLandingEnabled=!0)),k(t,!0),n.chatLibrary.party.isPartyExisted=!1):r.manipulateMessages(i,null)),n.chatLibrary.deviceType===u.deviceType.PHONE&&a.removeClass("hidden"),n.destroyDialogLayout(t),n.chatLibrary.minimizedDialogIdList.length>0&&(e=n.chatLibrary.minimizedDialogIdList.shift(),delete n.chatLibrary.minimizedDialogData[e],n.chatLibrary.dialogIdList.push(e),n.chatLibrary.dialogDict[e].isUpdated=!0,n.chatLibrary.dialogDict[e].updateStatus=u.dialogStatus.REPLACE),f.updateStorage(f.storageDictionary.dialogIdList,n.chatLibrary.dialogIdList,n.chatLibrary.cookieOption),f.updateStorage(f.storageDictionary.dialogDict,n.chatLibrary.dialogDict,n.chatLibrary.cookieOption),n.chatLibrary.dialogsLayout&&n.chatLibrary.dialogsLayout[t]&&(n.chatLibrary.dialogsLayout[t].collapsed=!1),n.chatLibrary.phoneInApp||(delete n.chatLibrary.dialogsLayout[t],f.updateStorage(f.storageDictionary.dialogsLayout,n.chatLibrary.dialogsLayout,n.chatLibrary.cookieOption)),n.chatLibrary.phoneInApp&&(n.chatLibrary.dialogInAppOpen=!1,o.closeDialog())},n.validLayoutId=function(t,i){if(!n.chatUserDict[t]){switch(i){case u.dialogType.FRIEND:n.chatApiParams.loadMoreFriends?b():n.chatLibrary.chatLayout.urlParseInitialized=!0;break;case u.dialogType.CHAT:default:n.chatApiParams.loadMoreConversations?n.getUserConversations():n.chatLibrary.chatLayout.urlParseInitialized=!0}return!1}return!0},n.startSpecificConversationFromUserId=function(t){var i=ot(t),r=u.dialogType.CHAT;i||(!n.chatLibrary.friendsDict[t]&&n.chatApiParams.loadMoreFriends&&b(null,{userId:t}),i=n.getLayoutId(t,u.dialogType.FRIEND),r=u.dialogType.FRIEND),n.validLayoutId(i,r)&&(n.chatLibrary.chatLayout.urlParseInitialized=!0,n.launchDialog(i))},n.startSpecificConversationFromConvId=function(t){var i=n.getLayoutId(t,u.dialogType.CHAT);p.debug("--attempting to open specific conversation on load: "+t+"--"),n.validLayoutId(i,u.dialogType.CHAT)&&(n.chatLibrary.chatLayout.urlParseInitialized=!0,n.launchDialog(i))},n.openSettingsPage=function(){if(n.chatLibrary.inApp){var t={feature:u.linksLibrary.settingTabName,urlPath:u.linksLibrary.settingLink};c.navigateToFeature(t,function(n){p.debug("navigateToFeature ---- status:"+n)})}else window.location.href=l.getAbsoluteUrl(u.linksLibrary.settingLink)},at=function(){angular.element(a).bind("resize",function(){!n.chatLibrary.chatLayout.resizing&&n.chatLibrary.dialogIdList.length>0&&(n.chatLibrary.chatLayout.resizing=!0,ft(),st()||ei()?(p.debug(" ------- need to resize -------------- "),n.onResize()):n.chatLibrary.chatLayout.resizing=!1)}),n.$on("Roblox.Chat.destroyChatCookie",function(){f.removeFromStorage(f.storageDictionary.dialogIdList,n.chatLibrary.cookieOption),f.removeFromStorage(f.storageDictionary.dialogDict,n.chatLibrary.cookieOption),f.removeFromStorage(f.storageDictionary.dialogsLayout,n.chatLibrary.cookieOption),f.removeFromStorage(f.storageDictionary.chatBarLayout,n.chatLibrary.cookieOption),f.removeFromStorage(f.storageDictionary.chatFriendsListReloadTime),e.removeLocalStorage(n.chatLibrary.dialogLocalStorageName)}),n.$on("Roblox.Chat.LoadUnreadConversationCount",function(){rt()}),v.bind("Roblox.Chat.StartChat",function(t,i){n.startSpecificConversationFromUserId(i.userId)})},ct(),at(),n.$watch(function(){return n.chatViewModel},function(t,i){if(!angular.isUndefined(t)&&!angular.equals(t,i)){n.chatLibrary.chatLayout.pageInitializing=!0,ht();try{ti(),ii()}catch(u){var r="pageInitializing: ";u&&u.message&&(r+=u.message),h.fireEvent(n.chatLibrary.googleAnalyticsEvent.category,n.chatLibrary.googleAnalyticsEvent.action,r)}}})}]);

;// ~/viewapp/pages/chat/controllers/dialogsController.js
"use strict";chat.controller("dialogsController",["$scope","chatService","chatUtility","partyService","messageService","chatHybridService","$window","$log",function(n,t,i,r,u,f,e,o){n.isNewGroupChat=function(t){return t.dialogType===i.dialogType.NEWGROUPCHAT||n.chatLibrary.isAddFriendsTo1To1ConversationEnabled&&t.addMoreFriends&&!t.isGroupChat},n.canAddFriendInExistedConversation=function(n){return n.addMoreFriends&&n.isGroupChat},n.generateDialog=function(t,r,u){var e=u.layoutId,o=n.getLayoutId(t.id,r),s;t.dialogType=r,e!==o?(n.getUserInfoForConversation(t),t.layoutId=o,t.isConversation=!0,n.updateChatViewModel(t,!0),n.isNewGroupChat(n.chatUserDict[e])&&(t.isRenameEditorNeeded=!0),n.chatUserDict[e].selectedUserIds=[],n.chatUserDict[e].selectedUsersDict={},u.preserved?n.chatUserDict[e].addMoreFriends=!1:delete n.chatUserDict[e],s=n.chatLibrary.dialogIdList.indexOf(e),s>-1&&!u.preserved?(n.destroyDialogLayout(e),delete n.chatLibrary.dialogDict[e],n.chatLibrary.dialogIdList[s]=o,n.chatLibrary.dialogDict[o]=angular.copy(i.dialogInitValue)):n.updateDialogList(o,!0),n.chatLibrary.inApp&&!n.chatLibrary.tabletInApp&&(u.preserved&&(n.chatLibrary.dialogInAppOpen=!0),f.openDialog())):(n.getUserInfoForConversation(t),n.updateChatViewModel(t,!0),n.chatLibrary.dialogDict[e].isUpdated=!0,n.chatLibrary.dialogDict[e].updateStatus=i.dialogStatus.REFRESH)},n.createParty=function(t,u){i.cleanPartyList(n.chatLibrary,n.chatUserDict,null);var f=n.chatUserDict[u].selectedUserIds,e=t.id;n.chatUserDict[u].selectedUserIds=[],r.partyCreate(e,f).then(function(r){if(r){n.chatLibrary.party.isPartyLeader=!0,t.party=r;var f={layoutId:u};n.generateDialog(t,i.dialogType.PARTY,f)}})},n.sendInvite=function(u){var f,e,s,h,c;o.debug("------------- sendInvite ------------"),f=n.chatUserDict[u],f.dialogType!==i.dialogType.CHAT&&f.dialogType!==i.dialogType.GROUPCHAT||f.addMoreFriends?n.canAddFriendInExistedConversation(f)?t.addToConversation(f.selectedUserIds,f.id).then(function(t){if(t&&t.resultType===i.resultType.SUCCESS&&t.conversationId){if(f.addMoreFriends=!1,n.chatUserDict[u].dialogType===i.dialogType.PARTY||n.chatUserDict[u].party){var e=f.selectedUserIds;e.forEach(function(n){r.partyInvite(f.party.Id,n)})}f.userIds=f.userIds.concat(f.selectedUserIds),f.selectedUserIds=[],f.selectedUsersDict={}}}):n.isNewGroupChat(f)&&(h={layoutId:u},f.addMoreFriends&&!f.isGroupChat&&(c=f.participants,angular.forEach(c,function(t){var i=t.targetId;i!==n.chatLibrary.userId&&(f.selectedUserIds.push(i),f.selectedUsersDict[i]=angular.copy(n.chatLibrary.friendsDict[i]),f.selectedUsersDict[i].hiddenFromSelection=!0)}),h.preserved=!0),t.startGroupConversation(f.selectedUserIds).then(function(t){if(t.resultType===i.resultType.SUCCESS){var r=t.conversation;r.isGroupChat=r.conversationType===i.conversationType.multiUserConversation,n.generateDialog(r,i.dialogType.GROUPCHAT,h)}})):(e=angular.copy(f.userIds),s=e.indexOf(n.chatLibrary.userId),s>-1&&e.splice(s,1),f.selectedUserIds=e,n.createParty(f,u))}}]);

;// ~/viewapp/pages/chat/directives/chatBarDirective.js
"use strict";chat.directive("chatBar",["resources",function(n){return{restrict:"A",scope:!0,replace:!0,templateUrl:n.templates.chatBarTemplate,link:function(){Roblox.BootstrapWidgets.SetupTooltip()}}}]);

;// ~/viewapp/pages/chat/directives/lazyLoadDirective.js
"use strict";chat.directive("lazyLoad",["chatService","chatUtility","$log",function(n,t,i){return{restrict:"A",scope:!0,link:function(r,u){var e=function(){r.buildChatUserListByFriends(r.chatApiParams.startIndexOfFriendList,r.chatApiParams.pageSizeOfFriendList).then(function(n){r.chatLibrary.chatLayout.isChatLoading=!1,r.filterFriends(n),n&&n.length>0?(r.chatApiParams.startIndexOfFriendList=+r.chatApiParams.startIndexOfFriendList+r.chatApiParams.pageSizeOfFriendList,t.updateScrollbar(t.chatLayout.scrollbarClassName),n.length<r.chatApiParams.pageSizeOfFriendList&&(r.chatApiParams.loadMoreFriends=!1,r.chatApiParams.startIndexOfFriendList=0)):(r.chatApiParams.loadMoreFriends=!1,r.chatApiParams.startIndexOfFriendList=0)},function(){r.chatLibrary.chatLayout.isChatLoading=!1,i.debug("---error from get Friends in lazyLoadDirective.js---")})};r.callbackLazyLoad=function(){if(!r.chatApiParams||r.chatLibrary.chatLayout.errorMaskEnable||!r.chatApiParams.loadMoreConversations&&!r.chatApiParams.loadMoreFriends)return!1;r.chatLibrary.chatLayout.isChatLoading=!0,r.chatApiParams.loadMoreConversations&&n.getUserConversations(r.chatApiParams.pageNumberOfConversations,r.chatApiParams.pageSizeOfConversations).then(function(n){r.chatLibrary.chatLayout.isChatLoading=!1,n&&n.length>0?(r.refreshFriendsDict(),r.buildChatUserListByConversations(n),r.chatApiParams.pageNumberOfConversations++,t.updateScrollbar(t.chatLayout.scrollbarClassName),n.length<r.chatApiParams.pageSizeOfConversations&&(r.chatApiParams.loadMoreConversations=!1,r.chatApiParams.loadMoreFriends=!0,r.chatApiParams.pageNumberOfConversations=1,r.chatApiParams.pageNumberOfPartyInvites=1,e())):(r.chatApiParams.loadMoreConversations=!1,r.chatApiParams.loadMoreFriends=!0,r.chatApiParams.pageNumberOfConversations=1,e())},function(){r.chatLibrary.chatLayout.isChatLoading=!1,i.debug("---error from get Conversations in lazyLoadDirective.js---")}),r.chatApiParams.loadMoreFriends&&e()},r.chatLibrary.inApp?Roblox.Scrollbar.listenToScroll(u,null,r.callbackLazyLoad):u.mCustomScrollbar({autoExpandScrollbar:!1,scrollInertia:5,contentTouchScroll:1,mouseWheel:{preventDefault:!0},callbacks:{onTotalScrollOffset:100,onTotalScroll:r.callbackLazyLoad,onOverflowYNone:r.callbackLazyLoad}})}}}]);

;// ~/viewapp/pages/chat/directives/dialogDirective.js
"use strict";chat.directive("dialog",["$window","$compile","$templateCache","$interval","$timeout","chatService","chatUtility","chatClientStorageUtilityService","partyService","ngAudio","localStorageService","messageService","resources","$log",function(n,t,i,r,u,f,e,o,s,h,c,l,a,v){return{restrict:"A",scope:{dialogData:"=",chatLibrary:"=",closeDialog:"&",sendInvite:"&"},link:function(r,f){var y=angular.copy(e.dialogLayout.limitMemberDisplay),k=null,w=0,b=function(){r.dialogLayout.isBannerEnabled=!1,r.dialogData.dialogType===e.dialogType.PARTY||r.dialogData.dialogType===e.dialogType.PENDINGPARTY?(v.debug(" --------------------party or pending party------------------- "+r.dialogLayout.bannerType),r.dialogLayout.renameEditor.isEnabled||(r.dialogLayout.isBannerEnabled=!0),r.dialogLayout.hasBanner=!0,r.dialogLayout.bannerType=r.dialogData.dialogType===e.dialogType.PARTY&&r.dialogData.party&&r.dialogData.party.GamePlaceId?e.dialogBannerTypes.game:e.dialogBannerTypes.member):(r.dialogLayout.hasBanner=!1,r.dialogLayout.isBannerEnabled=!1,r.dialogLayout.bannerType=e.dialogBannerTypes.default)},d=function(){r.isOverLoaded(),r.dialogData.currentUserId=r.currentUserId;switch(r.dialogData.dialogType){case e.dialogType.CHAT:var n;angular.forEach(r.dialogData.userIds,function(t){t!==r.chatLibrary.userId&&(n=t)}),r.dialogLayout.title=r.chatLibrary.friendsDict[n]?r.chatLibrary.friendsDict[n].name:r.dialogData.title,r.dialogLayout.templateUrl=a.templates.dialogTemplate,r.dialogLayout.scrollbarElm=e.getScrollBarSelector(r.dialogData,e.scrollBarType.MESSAGE),r.dialogData.name=r.chatLibrary.friendsDict[n]?r.chatLibrary.friendsDict[n].name:r.dialogData.title,r.dialogData.nameLink=r.chatLibrary.friendsDict[n]?r.chatLibrary.friendsDict[n].UserProfileLink:"",b();break;case e.dialogType.PENDINGPARTY:r.dialogLayout.templateUrl=r.dialogData.isGroupChat?a.templates.groupDialogTemplate:a.templates.dialogTemplate,r.dialogLayout.limitMemberDisplay=y/2,r.dialogLayout.scrollbarElm=e.getScrollBarSelector(r.dialogData,e.scrollBarType.MESSAGE),r.dialogData.name=r.dialogData.title,b();break;case e.dialogType.GROUPCHAT:r.dialogLayout.templateUrl=a.templates.groupDialogTemplate,r.dialogLayout.limitMemberDisplay=r.dialogData.party?y/2:y,r.dialogLayout.scrollbarElm=e.getScrollBarSelector(r.dialogData,e.scrollBarType.MESSAGE),r.dialogData.name=r.dialogData.title,b();break;case e.dialogType.PARTY:r.dialogData.partyName=r.dialogData.partyName?r.dialogData.partyName:e.party.partyName,r.dialogLayout.templateUrl=r.dialogData.isGroupChat?a.templates.groupDialogTemplate:a.templates.dialogTemplate,r.dialogLayout.limitMemberDisplay=r.dialogData.party.LeaderUser.Id===r.chatLibrary.userId?y/2:y,r.dialogLayout.scrollbarElm=e.getScrollBarSelector(r.dialogData,e.scrollBarType.MESSAGE),r.dialogData.party.GamePlaceId&&!r.dialogData.placeThumbnail&&s.getPlace(r.dialogData.party.GamePlaceId).then(function(n){r.dialogData.placeThumbnail=n}),r.dialogData.name=r.dialogData.title?r.dialogData.title:r.dialogData.partyName,b();break;case e.dialogType.NEWGROUPCHAT:r.dialogLayout.title=r.dialogData.title,r.dialogLayout.templateUrl=a.templates.newGroupTemplate,r.dialogData.name=r.dialogData.title;break;case e.dialogType.NEWPARTY:r.dialogLayout.title=r.dialogData.title,r.dialogLayout.templateUrl=a.templates.newGroupTemplate}r.updateDialogStyle()},at=function(){var n;r.chatLibrary&&r.chatLibrary.dialogScopeLib[r.dialogData.id]&&(n=r.chatLibrary.dialogScopeLib[r.dialogData.id]),r.$$childHead&&r.$$childHead!=null&&r.$$childHead.timeStamp===n&&r.$$childHead.$destroy()},lt=function(){var n,u,e,o;(r.dialogLayout.IsdialogContainerVisible||f.find(".dialog-container"))&&(r.dialogLayout.IsdialogContainerVisible=!1,f.empty()),n=angular.element(i.get(r.dialogLayout.templateUrl)),at(),u=r.$new(),e=Date.now(),r.chatLibrary&&(r.chatLibrary.dialogScopeLib[r.dialogData.id]=e),u.timeStamp=e,o=t(n),f.append(n),o(u)},ct=function(){var n="";return angular.isDefined(window.getSelection)?n=window.getSelection().toString():angular.isDefined(document.selection)&&document.selection.type==="Text"&&(n=document.selection.createRange().text),n.length>0},ht=function(t){var o=r.dialogData.layoutId,a="#"+o,i=r.chatLibrary.chatLayout,u=angular.element(document.querySelector(a)).find(".dialog-container"),v=i.widthOfChat,s=i.widthOfDialog+i.spaceOfDialog,h=t.indexOf(o),e,c,f,l;r.chatLibrary.inApp?u.addClass("dialog-visible"):(e=+v+h*s+i.spaceOfDialog,c=n.innerWidth,c<e+s?(f=+i.defaultChatZIndex+1,u.css("z-index",f)):(f=+i.defaultChatZIndex+h,u.css("right",e),u.css("z-index",f)),u.addClass("dialog-visible")),l=function(){r.$digest(r.toggleDialogFocusStatus(!0))};u.on("mouseup",l)},et=function(){r.chatLibrary.phoneInApp||(o.updateStorage(o.storageDictionary.dialogIdList,r.chatLibrary.dialogIdList,r.chatLibrary.cookieOption),o.updateStorage(o.storageDictionary.dialogDict,r.chatLibrary.dialogDict,r.chatLibrary.cookieOption))},ot=function(){r.chatLibrary.phoneInApp||(r.chatLibrary.dialogsLayout[r.dialogData.layoutId]=r.dialogLayout,o.updateStorage(o.storageDictionary.dialogsLayout,r.chatLibrary.dialogsLayout,r.chatLibrary.cookieOption))},tt=function(n){var t=angular.isDefined(r.dialogData.userIds)?r.dialogData.userIds.indexOf(n):-1,i=angular.isDefined(r.dialogData.selectedUserIds)?r.dialogData.selectedUserIds.indexOf(n):-1;return t<0&&i<0},p=function(){r.dialogLibrary=c.getLocalStorage(r.chatLibrary.dialogLocalStorageName)?c.getLocalStorage(r.chatLibrary.dialogLocalStorageName):{}},vt=function(){return r.dialogLibrary&&r.dialogLibrary[r.dialogData.layoutId]&&r.dialogLibrary[r.dialogData.layoutId].active},ft=function(){return r.dialogLibrary&&r.dialogLibrary[r.dialogData.layoutId]&&!r.dialogLibrary[r.dialogData.layoutId].active},nt=function(){return r.dialogLibrary&&r.dialogLibrary[r.dialogData.layoutId]&&r.dialogLibrary[r.dialogData.layoutId].played},ut=Math.floor(Math.random()*100+1),rt=1500+ut,g,it=function(){g=u(function(){p(),r.dialogLibrary&&!r.dialogLibrary[r.dialogData.layoutId].played?(r.chatLibrary.audio.play(),r.dialogLibrary[r.dialogData.layoutId].played=!0,c.setLocalStorage(r.chatLibrary.dialogLocalStorageName,r.dialogLibrary)):u.cancel(g)},rt)},st=function(){r.chatLibrary.inApp&&(r.dialogLayout.focusMeEnabled=!1)},yt=function(){r.dialogData.friendIds=angular.copy(r.chatLibrary.friendIds),r.dialogMessages=[],r.dialogType=angular.copy(e.dialogType),r.deviceType=angular.copy(e.deviceType),r.memberStatus=angular.copy(e.memberStatus),r.dialogBannerTypes=angular.copy(e.dialogBannerTypes),r.dialogLayout=angular.isDefined(r.chatLibrary.dialogsLayout[r.dialogData.layoutId])?r.chatLibrary.dialogsLayout[r.dialogData.layoutId]:angular.copy(e.dialogLayout),r.chatLibrary.inApp?r.dialogLayout.inAppStyle={}:r.dialogLayout.defaultStyle={}};r.updateDialogStyle=function(){var n;e.updateDialogStyle(r.dialogData,r.dialogLayout,r.chatLibrary),r.chatLibrary.inApp?(n=r.dialogLayout.inAppStyle,n&&n.inputStyle&&e.setResizeInputLayout(r.chatLibrary,n.inputStyle.height,r.dialogData,r.dialogLayout)):(n=r.dialogLayout.defaultStyle,n&&n.inputStyle&&e.setResizeInputLayout(r.chatLibrary,n.inputStyle.height,r.dialogData,r.dialogLayout))},r.updateFriends=function(n){var t=[],u,i;n?(i=e.sortFriendList(r.chatLibrary,n),i&&(i.forEach(function(n){tt(n.Id)&&t.push(n.Id),r.chatLibrary.friendsDict[n.Id]||(r.chatLibrary.friendsDict[n.Id]=n)}),r.dialogData.friendIds=t)):(u=angular.copy(r.chatLibrary.friendIds),angular.forEach(u,function(n){tt(n)&&t.push(n)}),r.dialogData.friendIds=t)},r.isOverLoaded=function(){angular.isUndefined(r.dialogData.selectedUserIds)&&(r.dialogData.selectedUserIds=[],r.dialogData.selectedUsersDict={}),r.dialogData.dialogType!==e.dialogType.FRIEND&&(r.dialogData.numberOfSelected=r.dialogData.dialogType===e.dialogType.NEWGROUPCHAT?r.dialogData.selectedUserIds.length:r.dialogData.dialogType===e.dialogType.CHAT?r.dialogData.userIds.length+r.dialogData.selectedUserIds.length:r.dialogData.userIds.length+r.dialogData.selectedUserIds.length-1,r.dialogLayout.isMembersOverloaded=r.dialogData.numberOfSelected>=r.chatLibrary.quotaOfPartyMembers?!0:!1)},r.dialogData.selectedUserIds=[],r.dialogData.selectedUsersDict={},r.selectFriends=function(n){var t=r.dialogData.selectedUserIds.indexOf(n);t<0&&!r.dialogLayout.isMembersOverloaded?(r.dialogData.selectedUserIds.push(n),r.dialogData.selectedUsersDict[n]=angular.copy(r.chatLibrary.friendsDict[n])):t>-1&&(r.dialogData.selectedUserIds.splice(t,1),delete r.dialogData.selectedUsersDict[n]),r.dialogData.searchTerm="",r.isOverLoaded()},r.toggleDialogContainer=function(){r.chatLibrary.inApp||(r.dialogLayout.collapsed=!r.dialogLayout.collapsed,r.toggleDialogFocusStatus()),r.chatLibrary.phoneInApp||ot()},r.toggleDialogFocusStatus=function(n){r.chatLibrary.inApp||(r.dialogLayout.hasFocus=n,n&&r.dialogLayout.active&&r.markInactive()),n&&l.markMessagesAsRead(r.dialogData);var t=n&&!ct()&&!r.chatLibrary.inApp&&!r.dialogLayout.collapsed&&!r.dialogLayout.renameEditor.isEnabled;r.dialogLayout.focusMeEnabled=t},r.getTitle=function(n){var u,t,i,f;r.dialogData.dialogType===e.dialogType.PENDINGPARTY&&n===e.activeType.PARTYINVITE?(t=r.dialogData.party?r.dialogData.party.CreatorUser.Name:r.dialogData.initiator.name,u=e.chatLayout.defaultTitleForPartyInvite+t):(i=r.dialogData.chatMessages,i&&i.length>0?(f=i[0].senderTargetId,t=r.chatLibrary.friendsDict[f].name):t=r.dialogData.initiator.name,u=t+e.chatLayout.defaultTitleForMessage),r.title=u},r.changeTitle=function(){n.document.title=w%2==0?r.title:r.chatLibrary.currentTabTitle,w++},r.markInactive=function(){r.dialogLayout.active&&(r.dialogLayout.active=!1,clearInterval(k),w=0,n.document.title=r.chatLibrary.currentTabTitle,p(),vt()&&(v.debug(" --------------- markInactive -------------- set into local storage"),angular.isUndefined(r.dialogLibrary[r.dialogData.layoutId])&&(r.dialogLibrary[r.dialogData.layoutId]={}),r.dialogLibrary[r.dialogData.layoutId].active=!1,r.dialogLibrary[r.dialogData.layoutId].played=!1,c.setLocalStorage(r.chatLibrary.dialogLocalStorageName,r.dialogLibrary)))},r.markActive=function(n){p(),angular.isUndefined(r.dialogLibrary[r.dialogData.layoutId])&&(r.dialogLibrary[r.dialogData.layoutId]={}),r.dialogLibrary[r.dialogData.layoutId].active=!0,r.dialogLibrary[r.dialogData.layoutId].played=!1,c.setLocalStorage(r.chatLibrary.dialogLocalStorageName,r.dialogLibrary),r.dialogLayout.hasFocus?l.markMessagesAsRead(r.dialogData):(clearInterval(k),w=0,p(),nt()||r.chatLibrary.inApp||it(),r.getTitle(n),k=setInterval(r.changeTitle,r.chatLibrary.intervalOfChangeTitleForPartyChrome)),r.chatLibrary.inApp||(r.dialogLayout.active=!0),r.dialogLayout.focusMeEnabled&&(r.dialogLayout.focusMeEnabled=!1)},r.handleLocalStorage=function(n){n.key===r.chatLibrary.dialogLocalStorageName&&(p(),r.dialogLayout.active&&ft()&&r.markInactive(),nt()&&u.cancel(g))},r.checkNewGenerationDialogStatus=function(){r.dialogData.isRenameEditorNeeded&&r.chatLibrary.isRenameConversationTitleInChatEnabled&&(r.dialogLayout.focusMeEnabled&&(r.dialogLayout.focusMeEnabled=!1),r.dialogData.isRenameEditorNeeded=!1,r.dialogLayout.renameEditor.isEnabled=!0,r.dialogLayout.renameEditor.hasFocus=!0)},yt(),st(),r.isOverLoaded(),r.$watch(function(){return r.chatLibrary.dialogDict},function(n,t){if(angular.isDefined(n)&&angular.isDefined(n[r.dialogData.layoutId])){var u=r.dialogData.layoutId,o=r.chatLibrary,s=o.dialogIdList.indexOf(u),i=n[u],h=t[u];if(!h||i.isUpdated){angular.isDefined(r.chatLibrary.dialogsLayout[r.dialogData.layoutId])?r.dialogLayout=r.chatLibrary.dialogsLayout[r.dialogData.layoutId]:angular.isUndefined(r.dialogLayout)?r.dialogLayout=angular.copy(e.dialogLayout):i.updateStatus===e.dialogStatus.INIT&&r.dialogLayout&&(r.dialogLayout.renameEditor=angular.copy(e.dialogLayout.renameEditor)),i.isUpdated=!1;switch(i.updateStatus){case e.dialogStatus.INIT:case e.dialogStatus.REPLACE:s>-1&&(r.dialogLayout.focusMeEnabled===i.autoOpen&&(r.chatLibrary.inApp||(r.dialogLayout.focusMeEnabled=!i.autoOpen),i.autoOpen||l.markMessagesAsRead(r.dialogData)),r.checkNewGenerationDialogStatus(),d(),lt(),Roblox.BootstrapWidgets.SetupTooltip(),Roblox.BootstrapWidgets.SetupPopover());break;case e.dialogStatus.MINIMIZE:d(),r.chatLibrary.minimizedDialogIdList.indexOf(u)<0&&(r.chatLibrary.minimizedDialogIdList.push(u),r.chatLibrary.minimizedDialogData[u]=r.dialogData),f.empty();break;case e.dialogStatus.REFRESH:d(),i.updateStatus=e.dialogStatus.INIT}}r.chatLibrary.phoneInApp||et(),s>-1&&(ht(o.dialogIdList),i.markAsActive&&(r.markActive(i.activeType),i.markAsActive=!1))}},!0),r.$on("Roblox.Chat.MarkDialogInactive",function(n,t){t.layoutId===r.dialogData.layoutId&&r.markInactive()}),c.listenLocalStorage(r.handleLocalStorage)}}}]);

;// ~/viewapp/pages/chat/directives/groupSelectDirective.js
"use strict";chat.directive("groupSelect",["$log",function(){return{restrict:"A",link:function(n,t){var r=n.chatLibrary.inApp?n.chatLibrary.inAppLayout.topBarHeight:n.chatLibrary.layout.topBarHeight;n.$watch(function(){return t.innerHeight()},function(t,i){if(t&&t!==i){var s="#"+n.dialogData.layoutId+" .dialog-container",h="#"+n.dialogData.layoutId+" "+n.friendsScrollbarElm,c=angular.element(s),e=angular.element(h),o,f,u;n.chatLibrary.inApp?(u=t,f="calc(100% - "+u+"px)"):(u=r+t,o=c.height(),f=o-u),e.css("height",f),e.mCustomScrollbar("update")}},!0)}}}]);

;// ~/viewapp/pages/chat/directives/abuseReportDirective.js
"use strict";chat.directive("abuseReport",["resources",function(n){return{restrict:"A",templateUrl:n.templates.abuseReportTemplate,link:function(){}}}]);

;// ~/viewapp/pages/chat/directives/confirmNegativeActionDirective.js
"use strict";chat.directive("confirmNegativeAction",["resources",function(n){return{restrict:"A",scope:{dialogLayout:"=",confirmCallback:"&"},templateUrl:n.templates.confirmNegativeActionTemplate}}]);

;// ~/viewapp/pages/chat/directives/friendsSelectionDirective.js
"use strict";chat.directive("friendsSelection",["chatUtility","resources",function(n,t){return{restrict:"A",templateUrl:t.templates.friendsSelectionTemplate,link:function(t){var u=function(){if(angular.isUndefined(t.dialogData)||angular.isUndefined(t.dialogData.selectedUserIds))return!1;t.dialogLayout.inviteBtnDisabled=t.dialogData.dialogType===n.dialogType.NEWGROUPCHAT?t.dialogData.selectedUserIds.length<2:t.dialogData.selectedUserIds.length===0};u(),t.$watch(function(){return t.dialogData&&t.dialogData.selectedUserIds},function(){u()},!0)}}}]);

;// ~/viewapp/pages/chat/controllers/dialogController.js
"use strict";chat.controller("dialogController",["$scope","chatService","chatUtility","partyService","messageService","$window","chatHybridService","hybridService","dialogAttributes","$log",function(n,t,i,r,u,f,e,o,s,h){var l=angular.element(document.querySelector("#chat-data-model"));n.removeFromConversation=function(i,r){t.removeFromConversation(n.chatLibrary.userId,i),n.chatLibrary.chatLayoutIds&&n.chatLibrary.chatLayoutIds.indexOf(r)>-1&&(n.chatLibrary.conversationsDict[i].remove=!0,n.closeDialog({layoutId:r}))};var a=function(){n.chatLibrary.party.isPartyExisted=!1,r.partyLeave(n.dialogData.party.Id).then(function(){i.removeParty(n.chatLibrary,n.dialogData)})},v=function(r){t.sendMessage(n.dialogData.id,r.rawContent).then(function(t){t&&(r.sendingMessage=!1,t.resultType!==i.resultType.SUCCESS?(r.sendMessageHasError=!0,r.error=i.errorMessges.messageContentModerated,t.resultType===i.resultType.MODERATED&&(r.content=i.hashOutContent(r.content),i.sanitizeMessage(r))):(angular.isUndefined(n.dialogData.messagesDict)&&(n.dialogData.messagesDict={}),r.id=t.messageId,r.sent=t.sent,u.buildTimeStamp(r,n.dialogData),r.resetClusterMessage=!0,i.sanitizeMessage(t),r.content=t.content,u.setClusterMaster(n.dialogData,r),n.dialogData.messagesDict[t.messageId]=r))},function(){h.debug(" ------ sendMessage error -------"),r.sendingMessage=!1,r.sendMessageHasError=!0})},c=function(){t.getFriends(n.chatLibrary.userId,n.dialogParams.startIndexOfFriendList,n.dialogParams.pageSizeOfFriendList).then(function(t){t&&t.length<=n.dialogParams.pageSizeOfFriendList?(n.updateFriends(t),n.dialogData.scrollBarType=i.scrollBarType.FRIENDSELECTION,t.length===n.dialogParams.pageSizeOfFriendList&&(n.dialogParams.loadMoreFriends=!0,n.dialogParams.startIndexOfFriendList=+n.dialogParams.startIndexOfFriendList+n.dialogParams.pageSizeOfFriendList,c())):n.dialogParams.loadMoreFriends=!1})};n.dialogParams=angular.copy(i.dialogParams),n.dialogLayout.numberOfPartyMembers=l.data("numberofmembersforpartychrome"),n.userPresenceTypes=i.userPresenceTypes,n.dialogData.messageForSend="",n.dialogLayout.scrollbarElm=i.getScrollBarSelector(n.dialogData,i.scrollBarType.MESSAGE),n.dialogLayout.listenToScrollInitialized=!1,n.friendsScrollbarElm=i.getScrollBarSelector(n.dialogData,i.scrollBarType.FRIENDSELECTION),n.focusDialog=function(){n.dialogLayout.active=!1},n.updateDialog=function(){if(h.debug("---- updateDialog callback ---- Scrollbars updated"),!n.dialogLayout.IsdialogContainerVisible){var t=angular.element(document.querySelector(n.dialogLayout.scrollbarElm));t.find(".mCustomScrollBox").addClass("dialog-visible"),n.dialogLayout.IsdialogContainerVisible=!0}return!1},n.sendMessage=function(){if(n.dialogData.messageForSend.length>0){var t={read:!0,content:n.dialogData.messageForSend,rawContent:n.dialogData.messageForSend,senderTargetId:n.chatLibrary.userId,sendingMessage:!0,sendMessageHasError:!1};i.sanitizeMessage(t),n.dialogData.messageForSend="",angular.isUndefined(n.dialogData.chatMessages)&&(n.dialogData.chatMessages=[]),u.setClusterMaster(n.dialogData,t),n.dialogData.displayMessage=t,v(t)}},n.keyPressEnter=function(){n.sendMessage()},n.abuseReport=function(t,i){if(n.dialogLayout.isConfirmationOn=!0,t&&(n.dialogData.userIdForAbuseReport=t),i&&n.dialogData.userIdForAbuseReport){n.chatLibrary.dialogInAppOpen=!1,e.closeDialog();var r=Roblox&&Roblox.Endpoints?Roblox.Endpoints.getAbsoluteUrl("/abusereport/chat?id="+n.dialogData.userIdForAbuseReport+"&redirectUrl="+escape(window.location)+"&conversationId="+n.dialogData.id):"/abusereport/chat?id="+n.dialogData.userIdForAbuseReport+"&redirectUrl="+escape(window.location)+"&conversationId="+n.dialogData.id;Roblox&&Roblox.AbuseReportDispatcher?Roblox.AbuseReportDispatcher.triggerUrlAction(r):window.location.href=r,n.dialogData.userIdForAbuseReport=null,n.dialogLayout.isConfirmationOn=!1}},n.leaveGroup=function(t){switch(n.dialogData.dialogType){case i.dialogType.PARTY:a();break;case i.dialogType.PENDINGPARTY:if(t){var u=n.dialogData.party.Id;r.removeFromParty(u,n.chatLibrary.userId)}case i.dialogType.GROUPCHAT:t?(n.chatLibrary.conversationsDict[n.dialogData.id].remove=!0,n.removeFromConversation(n.dialogData.id,n.dialogData.layoutId),n.resetConfirmDialog()):(n.dialogLayout.confirmDialog.isOpen=!0,n.dialogLayout.confirmDialog.title=s.negativeAction.leaveChatGroup.title,n.dialogLayout.confirmDialog.btnName=s.negativeAction.leaveChatGroup.btnName,n.dialogLayout.confirmDialog.type=s.negativeAction.leaveChatGroup.type)}},n.addFriends=function(){n.dialogData.addMoreFriends=!0,n.chatLibrary.friendIds.length>0&&n.updateFriends(),c()},n.viewParticipants=function(){n.dialogLayout.lookUpMembers=!n.dialogLayout.lookUpMembers},n.chatLibrary.isRenameConversationTitleInChatEnabled&&(n.toggleGroupNameEditor=function(){n.dialogLayout.renameEditor.isEnabled=!n.dialogLayout.renameEditor.isEnabled,n.dialogLayout.renameEditor.hasFocus=!n.dialogLayout.renameEditor.hasFocus,n.dialogLayout.hasBanner&&(n.dialogLayout.isBannerEnabled=!n.dialogLayout.renameEditor.isEnabled),n.updateDialogStyle(),n.dialogLayout.focusMeEnabled=!n.dialogLayout.renameEditor.isEnabled},n.renameTitle=function(){var r=angular.copy(n.dialogData.title);t.renameGroupConversation(n.dialogData.id,n.dialogData.name).then(function(t){if(t){switch(t.resultType){case i.resultType.MODERATED:u.buildSystemMessage(i.notificationType.conversationTitleModerated,n.dialogData,!0),i.updateConversationTitle(n.dialogData,r);break;case i.resultType.SUCCESS:i.updateConversationTitle(n.dialogData,t.conversationTitle)}n.toggleGroupNameEditor()}})}),n.removeMember=function(u,f){if(f){if(n.resetConfirmDialog(),n.dialogData.dialogType===i.dialogType.PARTY){var e=n.dialogData.party.Id;r.removeFromParty(e,u)}t.removeFromConversation(u,n.dialogData.id).then(function(){n.isOverLoaded()})}else n.dialogLayout.confirmDialog.isOpen=!0,n.dialogLayout.confirmDialog.title=s.negativeAction.removeUser.title,n.dialogLayout.confirmDialog.btnName=s.negativeAction.removeUser.btnName,n.dialogLayout.confirmDialog.type=s.negativeAction.removeUser.type,n.dialogLayout.confirmDialog.params={userId:u}},n.resetConfirmDialog=function(){n.dialogLayout.confirmDialog.isOpen=!1,n.dialogLayout.confirmDialog.title="",n.dialogLayout.confirmDialog.btnName="",n.dialogLayout.confirmDialog.type="",n.dialogLayout.confirmDialog.params={}},n.confirmCallBack=function(){var t=n.dialogLayout.confirmDialog;switch(t.type){case s.negativeAction.removeUser.type:n.removeMember(t.params.userId,!0);break;case s.negativeAction.leaveChatGroup.type:n.leaveGroup(!0)}},n.joinParty=function(){r.partyJoin(n.dialogData.party.Id).then(function(t){t&&t.Success&&(n.chatLibrary.partyIds.push(n.dialogData.party.Id),n.chatLibrary.partiesDict[n.dialogData.party.Id]={conversationId:n.dialogData.id,layoutId:n.dialogData.layoutId},n.dialogData.dialogType=i.dialogType.PARTY)})},n.joinGame=function(){r.joinGame(n.dialogData,n.chatLibrary.inApp)},n.linkToProfile=function(n){return n.stopPropagation(),n.target.classList.contains("disabled")?(n.preventDefault(),!1):void 0},n.goToProfile=function(t,i){if(n.chatLibrary.inApp)return t.stopPropagation(),t.preventDefault(),n.chatLibrary.isHybridCallForGroupChatAvatarEnabled&&o.openUserProfile(parseInt(i),angular.noop),!1},t.getMessages(n.dialogData.id,null,n.dialogParams.pageSizeOfGetMessages).then(function(t){t&&t.length>0?(n.dialogData.chatMessages=[],n.dialogData.messagesDict={},u.manipulateMessages(n.dialogData,t,n.chatLibrary.friendsDict),n.dialogData.scrollBarType=i.scrollBarType.MESSAGE):(n.dialogData.scrollBarType=i.scrollBarType.MESSAGE,n.updateDialog())}),n.$on("elastic:resize",function(t,r,u,f){h.debug("---- oldHeight -----"+u+"---- newHeight -----"+f),u!==f&&(t.preventDefault(),t.stopPropagation(),i.setResizeInputLayout(n.chatLibrary,f,n.dialogData,n.dialogLayout))})}]);

;// ~/viewapp/pages/chat/directives/dialogLazyLoadDirective.js
"use strict";chat.directive("dialogLazyLoad",["chatService","chatUtility","messageService","$timeout","$log",function(n,t,i,r,u){return{restrict:"A",scope:!0,link:function(r,f){r.callbackScrollToBottom=function(){r.updateDialog()},r.callbackLazyLoad=function(){if(!r.dialogParams.loadMoreMessages||!r.dialogLayout.IsdialogContainerVisible)return!1;r.dialogLayout.isChatLoading=!0;var f=r.dialogData.chatMessages.length;n.getMessages(r.dialogData.id,r.dialogData.chatMessages[f-1].id,r.dialogParams.pageSizeOfGetMessages).then(function(n){if(r.dialogLayout.isChatLoading=!1,n){if(n.length>0){r.dialogLayout.scrollToBottom=!1;for(var u=0;u<n.length;u++)t.sanitizeMessage(n[u]),i.buildFallbackTimeStamp(n[u],r.dialogData),i.setFallbackClusterMaster(r.dialogData,n[u])}n.length<r.dialogParams.pageSizeOfGetMessages&&(r.dialogParams.loadMoreMessages=!1)}else r.dialogParams.loadMoreMessages=!1,i.manipulateMessages(r.dialogData,n,r.chatLibrary.friendsDict)},function(){r.dialogLayout.isChatLoading=!1,u.debug("---error from get getMessages in dialogLazyLoadDirective.js---")})};var o=function(){u.debug("---- onInit callback ---- Scrollbars updated"),r.dialogLayout.scrollToBottom=!0};r.chatLibrary.inApp?(r.dialogLayout.IsdialogContainerVisible=!0,Roblox.Scrollbar.scrollToBottom(f),r.$watch(function(){return f.height()},function(n){n&&Roblox.Scrollbar.scrollToBottom(f)},!0),r.$watch(function(){return r.dialogData.chatMessages},function(n,t){(!t||t.length===0||n&&n.length>0&&t.length>0&&n[0].parsedTimestamp!==t[0].parsedTimestamp)&&Roblox.Scrollbar.scrollToBottom(f)},!0),r.$on("ngRepeatFinished",function(){if(u.debug("ngRepeatFinishedEvent"),r.dialogData.chatMessages){var n=r.chatLibrary.dialogScopeLib[r.dialogData.id];r.timeStamp!==n||r.dialogLayout.listenToScrollInitialized||(r.dialogLayout.listenToScrollInitialized=!0,Roblox.Scrollbar.listenToScroll(f,r.callbackLazyLoad))}})):f.mCustomScrollbar({autoExpandScrollbar:!1,scrollInertia:5,contentTouchScroll:1,mouseWheel:{preventDefault:!0},callbacks:{onInit:o,onUpdate:function(){u.debug("---- onUpdate callback ---- Scrollbars updated"+r.dialogLayout.scrollToBottom),r.dialogLayout.scrollToBottom?f.mCustomScrollbar("scrollTo","bottom",{scrollInertia:0}):r.dialogLayout.scrollToBottom=!0,f.hasClass("mCS_no_scrollbar")&&r.updateDialog()},onTotalScroll:r.callbackScrollToBottom,onTotalScrollOffset:60,onTotalScrollBack:r.callbackLazyLoad}})}}}]);

;// ~/viewapp/pages/chat/directives/dialogMinimizeDirective.js
"use strict";chat.directive("dialogMinimize",["$window","$compile","$templateCache","chatService","chatUtility","resources","$log",function(n,t,i,r,u,f,e){return{restrict:"A",scope:{chatLibrary:"="},templateUrl:f.templates.dialogMinimizeTemplate,link:function(n,t){var r=function(){var i=n.chatLibrary.chatLayout,r=n.chatLibrary.dialogIdList.length,u=i.widthOfChat,f=i.widthOfDialog+i.spaceOfDialog,e=+u+r*f+i.spaceOfDialog;t.css("right",e)};n.dialogType=u.dialogType,n.hasMinimizedDialogs=!1,n.layoutIdHasClicked=!1,n.openDialog=function(t){var i,r;e.debug(" -------------------openDialog------------------ "+t),i=n.chatLibrary.dialogIdList.pop(),n.chatLibrary.dialogDict[i].isUpdated=!0,n.chatLibrary.dialogDict[i].updateStatus=u.dialogStatus.MINIMIZE,n.chatLibrary.dialogIdList.push(t),n.chatLibrary.dialogDict[t].isUpdated=!0,n.chatLibrary.dialogDict[t].updateStatus=u.dialogStatus.REPLACE,r=n.chatLibrary.minimizedDialogIdList.indexOf(t),r>-1&&(n.chatLibrary.minimizedDialogIdList.splice(r,1),delete n.chatLibrary.minimizedDialogData[t])},n.remove=function(t){var i=n.chatLibrary.minimizedDialogIdList.indexOf(t);i>-1&&(n.chatLibrary.minimizedDialogIdList.splice(i,1),delete n.chatLibrary.minimizedDialogData[t],delete n.chatLibrary.dialogDict[t])},Roblox.BootstrapWidgets.SetupPopover("top",{selector:"#dialogs-minimize"}),n.$watch(function(){return n.chatLibrary.minimizedDialogIdList},function(t,i){angular.isUndefined(t)||t==i||(e.debug("------ watch minimizedDialogIdList ----- "),t.length>0?(n.hasMinimizedDialogs||(n.hasMinimizedDialogs=!0),r()):t.length===0&&(n.hasMinimizedDialogs=!1))},!0)}}}]);

;// ~/viewapp/pages/chat/directives/minimizeItemDirective.js
"use strict";chat.directive("minimizeItem",["$log",function(){return{restrict:"A",scope:!0,link:function(n){var u=function(){n.$apply(n.openDialog(n.dialogLayoutId))},r;angular.element("#dialogs-minimize").on("click touchstart",".popover-content #"+n.dialogLayoutId+" .minimize-title",u);r=function(){n.$apply(n.remove(n.dialogLayoutId))};angular.element("#dialogs-minimize").on("click touchstart",".popover-content #"+n.dialogLayoutId+" .minimize-close",r)}}}]);

;// ~/viewapp/pages/chat/directives/chatSettingDirective.js
"use strict";chat.directive("chatSetting",["chatService","partyService","$log",function(){return{restrict:"A",scope:!0,link:function(n,t){var s=function(t){n.chatLibrary.inApp&&t.preventDefault(),n.$digest(n.addFriends())},r,u,f,e,o;t.on("click touchstart","#add-friends",s);r=function(t){n.chatLibrary.inApp&&t.preventDefault(),n.$digest(n.viewParticipants())};t.on("click touchstart","#view-participants",r);u=function(t){n.chatLibrary.inApp&&t.preventDefault(),n.$digest(n.toggleGroupNameEditor())};t.on("click touchstart","#open-group-name-editor",u);f=function(t){n.chatLibrary.inApp&&t.preventDefault(),n.$digest(n.leaveGroup())};t.on("click touchstart","#leave-group",f);if(e=function(t){var i=t.data;n.$digest(n.abuseReport(i.userId,i.isConfirmed))},n.dialogData&&!n.dialogData.isGroupChat){angular.forEach(n.dialogData.userIds,function(t){t!==n.chatLibrary.userId&&(o=t)});t.on("click touchstart","#abuse-report",{userId:o,isConfirmed:!1},e)}}}}]);

;// ~/viewapp/pages/chat/controllers/friendsController.js
"use strict";chat.controller("friendsController",["$scope","chatService","chatUtility","$log",function(n,t,i){n.dialogLayout.scrollToBottom=!1,n.dialogLayout.IsdialogContainerVisible=!1,n.dialogParams=angular.copy(i.dialogParams),n.dialogType=angular.copy(i.dialogType),n.userPresenceTypes=angular.copy(i.userPresenceTypes),n.friendsScrollbarElm=i.getScrollBarSelector(n.dialogData,i.scrollBarType.FRIENDSELECTION),n.dialogData.scrollBarType=i.scrollBarType.FRIENDSELECTION,n.dialogData.isCreated=!0;var u=function(){t.getFriends(n.chatLibrary.userId,n.dialogParams.startIndexOfFriendList,n.dialogParams.pageSizeOfFriendList).then(function(t){t&&t.length>0&&(n.updateFriends(t),t.length===n.dialogParams.pageSizeOfFriendList&&(n.dialogParams.loadMoreFriends=!0,n.dialogParams.startIndexOfFriendList=+n.dialogParams.startIndexOfFriendList+n.dialogParams.pageSizeOfFriendList,u())),(!t||t.length<n.dialogParams.pageSizeOfFriendList)&&(n.dialogParams.loadMoreFriends=!1,n.dialogParams.startIndexOfFriendList=0)})};n.chatLibrary.friendIds.length>0&&n.updateFriends(),u(),n.isOverLoaded()}]);

;// ~/viewapp/pages/chat/directives/friendsLazyLoadDirective.js
"use strict";chat.directive("friendsLazyLoad",["chatService","$log",function(n){return{restrict:"A",scope:!0,link:function(t,i){var u=function(){if(!t.dialogParams.loadMoreFriends)return!1;t.dialogLayout.isChatLoading=!0,n.getFriends(t.chatLibrary.userId,t.dialogParams.startIndexOfFriendList,t.dialogParams.pageSizeOfFriendList).then(function(n){t.dialogLayout.isChatLoading=!1,t.updateFriends(n),n.length<t.dialogParams.pageSizeOfFriendList?t.dialogParams.loadMoreFriends=!1:t.dialogParams.startIndexOfFriendList=+t.dialogParams.startIndexOfFriendList+t.dialogParams.pageSizeOfFriendList,i.mCustomScrollbar("update")},function(){t.dialogLayout.isChatLoading=!1})};t.chatLibrary.inApp?Roblox.Scrollbar.listenToScroll(i,u):i.mCustomScrollbar({autoExpandScrollbar:!1,scrollInertia:5,contentTouchScroll:1,mouseWheel:{preventDefault:!0},callbacks:{onTotalScroll:u,onOverflowYNone:u}})}}}]);

;// ~/viewapp/pages/chat/directives/backBtnDirective.js
"use strict";chat.directive("backBtn",["$log",function(){return{restrict:"A",scope:!0,link:function(n,t){t.bind("click touchstart",function(t){t.preventDefault(),n.closeDialog(n.dialogData.layoutId)})}}}]);

;// ~/viewapp/pages/chat/directives/removeFocusDirective.js
"use strict";chat.directive("removeFocus",["$log",function(){return{restrict:"A",scope:!0,link:function(n,t){t.bind("click touchstart",function(t){t.preventDefault(),n.sendMessage()})}}}]);

;// ~/viewapp/pages/chat/directives/chatPlaceholderDirective.js
"use strict";chat.directive("chatPlaceholder",["resources",function(n){return{restrict:"A",scope:!0,templateUrl:n.templates.chatPlaceholderTemplate}}]);
